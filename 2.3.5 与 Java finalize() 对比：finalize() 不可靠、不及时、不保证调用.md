å¤ªå¥½äº†ï¼æˆ‘ä»¬ç°åœ¨è¿›å…¥ **2.3.5ï¼šä¸ Java finalize() å¯¹æ¯” â€” finalize() ä¸å¯é ã€ä¸åŠæ—¶ã€ä¸ä¿è¯è°ƒç”¨**ã€‚

è¿™æ˜¯ **RAII å“²å­¦çš„æ”¶å®˜è¯¾**ï¼Œå°†ç³»ç»Ÿå¯¹æ¯” C++ **ç¡®å®šæ€§ææ„** ä¸ Java **éç¡®å®šæ€§ finalize()** çš„æ ¹æœ¬å·®å¼‚ã€‚ä½œä¸ºæœ‰ 5â€“10 å¹´ Java ç»éªŒçš„å¼€å‘è€…ï¼Œä½ å¯èƒ½æ›¾ä¾èµ– `finalize()` é‡Šæ”¾èµ„æºï¼Œä½† Java å®˜æ–¹æ—©å·²**å¼ƒç”¨ finalize()**ï¼ˆJEP 421, Java 18+ï¼‰ï¼Œå› å…¶**ä¸å¯é ã€ä¸åŠæ—¶ã€ä¸ä¿è¯è°ƒç”¨**ã€‚è€Œ C++ çš„ææ„å‡½æ•°æä¾›**ç¼–è¯‘æœŸå¼ºåˆ¶ã€100% è°ƒç”¨ã€ç²¾ç¡®æ—¶æœº**çš„èµ„æºç®¡ç†ã€‚ç†è§£è¿™ä¸€å·®å¼‚ï¼Œèƒ½è®©ä½ å½»åº•æ‹¥æŠ± C++ çš„ RAII å“²å­¦ã€‚

æˆ‘ä»¬å°†ç»§ç»­ä¸¥æ ¼éµå¾ªä½ çš„å­¦ä¹ åå¥½ï¼š
- âœ… SMART ç›®æ ‡  
- âœ… ç»“æ„å…ˆè¡Œï¼ˆå¯¹æ¯”åœ°å›¾ï¼‰  
- âœ… ç”Ÿæ´»åŒ–æ¯”å–»  
- âœ… åŠ¨æ‰‹ä¸ºç‹ï¼ˆå«å¯¹æ¯”å®éªŒï¼‰  
- âœ… èºæ—‹å¤ä¹ ï¼ˆæ•´åˆ 2.3 å…¨ç³»åˆ— + Java ç»éªŒï¼‰  
- âœ… ä¸»åŠ¨ learning + å¤ç›˜

---

## ğŸ¯ KU 2.3.5ï¼šC++ ææ„ vs Java finalize()

> **æ‰€å±é˜¶æ®µ**ï¼šPhase 2 â€” é¢å‘å¯¹è±¡ç¼–ç¨‹  
> **å‰ç½®çŸ¥è¯†**ï¼š2.3.1â€“2.3.4ï¼ˆRAII å…¨ç³»åˆ—ï¼‰ã€Java finalize() æ·±åº¦ç»éªŒ  
> **åç»­è¡”æ¥**ï¼š2.4ï¼ˆæ‹·è´è¯­ä¹‰ï¼‰ã€3.2ï¼ˆæ™ºèƒ½æŒ‡é’ˆï¼‰  
> **é¢„è®¡è€—æ—¶**ï¼š2â€“3 å°æ—¶

---

### ğŸ§­ ä¸€ã€ç»“æ„å…ˆè¡Œï¼šå¯¹æ¯”åœ°å›¾

```
2.3.5 C++ ææ„ vs Java finalize()
â”œâ”€â”€ 1. è°ƒç”¨ä¿è¯
â”‚   â”œâ”€â”€ 1.1 C++ï¼š100% è°ƒç”¨ï¼ˆç¡®å®šæ€§ï¼‰
â”‚   â””â”€â”€ 1.2 Javaï¼šä¸ä¿è¯è°ƒç”¨ï¼ˆå¯èƒ½æ°¸ä¸è°ƒç”¨ï¼‰
â”œâ”€â”€ 2. è°ƒç”¨æ—¶æœº
â”‚   â”œâ”€â”€ 2.1 C++ï¼šç²¾ç¡®æ—¶æœºï¼ˆå¯¹è±¡é”€æ¯æ—¶ï¼‰
â”‚   â””â”€â”€ 2.2 Javaï¼šä¸ç¡®å®šæ—¶æœºï¼ˆGC æ—¶ï¼‰
â”œâ”€â”€ 3. å¯é æ€§
â”‚   â”œâ”€â”€ 3.1 C++ï¼šå¯é ï¼ˆå¯å¤„ç†å…³é”®èµ„æºï¼‰
â”‚   â””â”€â”€ 3.2 Javaï¼šä¸å¯é ï¼ˆä»…å»ºè®®ç”¨äº debugï¼‰
â”œâ”€â”€ 4. å¼‚å¸¸å¤„ç†
â”‚   â”œâ”€â”€ 4.1 C++ï¼šææ„ä¸­æŠ›å¼‚å¸¸ â†’ terminate
â”‚   â””â”€â”€ 4.2 Javaï¼šfinalize() æŠ›å¼‚å¸¸ â†’ è¢«å¿½ç•¥
â”œâ”€â”€ 5. å®˜æ–¹æ€åº¦
â”‚   â”œâ”€â”€ 5.1 C++ï¼šææ„æ˜¯æ ¸å¿ƒæœºåˆ¶
â”‚   â””â”€â”€ 5.2 Javaï¼šfinalize() å·²å¼ƒç”¨ï¼ˆJava 18+ï¼‰
â””â”€â”€ 6. ç°ä»£æ›¿ä»£æ–¹æ¡ˆ
    â”œâ”€â”€ 6.1 C++ï¼šRAIIï¼ˆå”¯ä¸€æ¨èï¼‰
    â””â”€â”€ 6.2 Javaï¼štry-with-resources / Cleaner
```

---

### ğŸ¯ äºŒã€SMART å­¦ä¹ ç›®æ ‡

- **Specific**ï¼šèƒ½ç³»ç»Ÿå¯¹æ¯” C++ ææ„ä¸ Java finalize() çš„ 5 å¤§å·®å¼‚ï¼Œç†è§£ finalize() è¢«å¼ƒç”¨çš„åŸå› ï¼Œå¹¶æŒæ¡ç°ä»£èµ„æºç®¡ç†æ–¹æ¡ˆã€‚
- **Measurable**ï¼šå®Œæˆ 2 ä¸ªå¯¹æ¯”å®éªŒ + 2 é“è¿ç§»é¢˜ï¼Œèƒ½è§£é‡Šä¸ºä½• finalize() ä¸èƒ½ç”¨äºå…³é”®èµ„æºé‡Šæ”¾ã€‚
- **Achievable**ï¼šé€šè¿‡â€œè‡ªåŠ¨ç®¡å®¶ vs ä¸´æ—¶å·¥â€æ¯”å–»ç†è§£å·®å¼‚ã€‚
- **Relevant**ï¼šè¿™æ˜¯å½»åº•è½¬å‘ C++ RAII å“²å­¦çš„å…³é”®ã€‚
- **Time-bound**ï¼š1â€“2 å¤©å†…å®Œæˆã€‚

---

### ğŸŒ ä¸‰ã€ç”Ÿæ´»åŒ–æ¯”å–»ï¼šè‡ªåŠ¨ç®¡å®¶ vs ä¸´æ—¶å·¥

> æƒ³è±¡ç®¡ç†ä¸€æ ‹å¤§æ¥¼ï¼š
>
> - **C++ ææ„ = è‡ªåŠ¨ç®¡å®¶**  
>   - **åˆåŒæ˜ç¡®**ï¼šé€€ç§Ÿæ—¶ï¼ˆå¯¹è±¡é”€æ¯ï¼‰ç«‹å³æ¸…ç†  
>   - **100% å¯é **ï¼šç»ä¸å¤±èŒ  
>   - **ç²¾ç¡®æ—¶æœº**ï¼šé€€ç§Ÿç¬é—´æ¸…ç†
>
> - **Java finalize() = ä¸´æ—¶å·¥**  
>   - **æ— åˆåŒ**ï¼šå¯èƒ½ never æ¥æ¸…ç†  
>   - **æ—¶æœºä¸å®š**ï¼šå¯èƒ½å‡ ä¸ªæœˆåæ‰æ¥  
>   - **å¯èƒ½å¤±èŒ**ï¼šæ¥äº†ä¹Ÿå¯èƒ½ä¸æ¸…ç†
>
> - **Java å®˜æ–¹æ€åº¦**ï¼š  
>   - â€œ**åˆ«ç”¨ä¸´æ—¶å·¥ï¼Œé›‡ä¸“ä¸šæ¸…æ´å…¬å¸**ï¼ˆtry-with-resourcesï¼‰â€

> ğŸ’¡ **å…³é”®è®¤çŸ¥**ï¼š**C++ ææ„æ˜¯ç¡®å®šæ€§å¥‘çº¦ï¼ŒJava finalize() æ˜¯ä¸å¯é ä¸´æ—¶å·¥**ã€‚

---

### ğŸ“š å››ã€çŸ¥è¯†ç‚¹åˆ†è§£

#### 1. è°ƒç”¨ä¿è¯
- **C++**ï¼š
  - **100% è°ƒç”¨**ï¼ˆåªè¦å¯¹è±¡è¢«é”€æ¯ï¼‰
  - ç¼–è¯‘æœŸå¼ºåˆ¶ï¼ˆRAII æœºåˆ¶ï¼‰
- **Java**ï¼š
  - **ä¸ä¿è¯è°ƒç”¨**ï¼ˆJVM å¯èƒ½ never GC å¯¹è±¡ï¼‰
  - å³ä½¿ GCï¼Œ`finalize()` **å¯èƒ½è¢«è·³è¿‡**

#### 2. è°ƒç”¨æ—¶æœº
- **C++**ï¼š
  - **ç²¾ç¡®æ—¶æœº**ï¼šæ ˆå¯¹è±¡ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œå †å¯¹è±¡ `delete` æ—¶
  - **å¯é¢„æµ‹**ï¼šç¨‹åºå‘˜å®Œå…¨æ§åˆ¶
- **Java**ï¼š
  - **ä¸ç¡®å®šæ—¶æœº**ï¼šä¾èµ– GC è§¦å‘
  - **å¯èƒ½å»¶è¿Ÿ**ï¼šå¯¹è±¡å­˜æ´»æœŸé—´æ°¸ä¸è°ƒç”¨

#### 3. å¯é æ€§
- **C++**ï¼š
  - **å¯é **ï¼šç”¨äºå…³é”®èµ„æºï¼ˆæ–‡ä»¶ã€é”ã€å†…å­˜ï¼‰
  - **ç”Ÿäº§ç¯å¢ƒæ ‡å‡†**ï¼šRAII æ˜¯ C++ åŸºçŸ³
- **Java**ï¼š
  - **ä¸å¯é **ï¼šä»…å»ºè®®ç”¨äº debug/logging
  - **ç”Ÿäº§ç¯å¢ƒç¦ç”¨**ï¼šJava 18+ å¼ƒç”¨ finalize()

#### 4. å¼‚å¸¸å¤„ç†
- **C++**ï¼š
  - ææ„æŠ›å¼‚å¸¸ â†’ `std::terminate`ï¼ˆç¨‹åº crashï¼‰
  - **å¿…é¡»å¤„ç†å¼‚å¸¸**ï¼ˆtry-catch åå™¬ï¼‰
- **Java**ï¼š
  - `finalize()` æŠ›å¼‚å¸¸ â†’ **è¢« JVM å¿½ç•¥**
  - **æ— å´©æºƒ**ï¼Œä½†èµ„æºå¯èƒ½æ³„æ¼

#### 5. å®˜æ–¹æ€åº¦
- **C++**ï¼š
  - ææ„å‡½æ•°æ˜¯**æ ¸å¿ƒè¯­è¨€ç‰¹æ€§**
  - RAII æ˜¯**æ ‡å‡†å®è·µ**
- **Java**ï¼š
  - **JEP 421**ï¼ˆJava 18ï¼‰ï¼šå¼ƒç”¨ `finalize()`
  - **å®˜æ–¹å»ºè®®**ï¼šç”¨ `try-with-resources` æˆ– `Cleaner`

#### 6. ç°ä»£æ›¿ä»£æ–¹æ¡ˆ
- **C++**ï¼š
  - **RAII**ï¼š`std::unique_ptr`, `std::lock_guard`, `std::fstream`
- **Java**ï¼š
  - **try-with-resources**ï¼š
    ```java
    try (FileInputStream file = new FileInputStream("data.txt")) {
        // è‡ªåŠ¨å…³é—­
    }
    ```
  - **Cleaner**ï¼ˆJava 9+ï¼‰ï¼š
    ```java
    public class Resource implements AutoCloseable {
        private static final Cleaner cleaner = Cleaner.create();
        private final Cleaner.Cleanable cleanable;
        
        public Resource() {
            this.cleanable = cleaner.register(this, new CleanupAction());
        }
        
        @Override
        public void close() {
            cleanable.clean(); // æ˜¾å¼æ¸…ç†
        }
    }
    ```

> ğŸ’¡ **è½¬å‹å¿ƒæ³•**ï¼š  
> **â€œåœ¨ Java ä¸­ï¼Œä½ ç¥ˆç¥·èµ„æºè¢«æ¸…ç†ï¼›åœ¨ C++ ä¸­ï¼Œä½ ç¡®ä¿èµ„æºè¢«æ¸…ç†â€**

---

### ğŸ’» äº”ã€åŠ¨æ‰‹ä¸ºç‹ï¼šå¯¹æ¯”å®éªŒ

#### å®éªŒ 1ï¼šJava finalize() ä¸å¯é 
```java
// FinalizeTest.java
public class FinalizeTest {
    private final int id;
    
    public FinalizeTest(int id) {
        this.id = id;
    }
    
    @Override
    protected void finalize() throws Throwable {
        System.out.println("Finalize " + id);
        super.finalize();
    }
    
    public static void main(String[] args) {
        for (int i = 0; i < 5; i++) {
            new FinalizeTest(i); // æ— å¼•ç”¨ï¼Œå¯ GC
        }
        System.gc(); // è¯·æ±‚ GC
        System.out.println("Main end");
    }
}
```
> âš ï¸ **å¯èƒ½è¾“å‡º**ï¼ˆfinalize æœªè°ƒç”¨ï¼‰ï¼š
> ```
> Main end
> ```
> æˆ–éƒ¨åˆ†è°ƒç”¨ï¼Œ**æ— ä¿è¯**ï¼

#### å®éªŒ 2ï¼šC++ ææ„ 100% è°ƒç”¨
```cpp
// DtorTest.cpp
#include <iostream>

class DtorTest {
    int id_;
public:
    DtorTest(int id) : id_(id) {
        std::cout << "Construct " << id_ << "\n";
    }
    ~DtorTest() {
        std::cout << "Destruct " << id_ << "\n";
    }
};

int main() {
    for (int i = 0; i < 5; i++) {
        DtorTest t(i);
    } // æ¯ä¸ª t ç¦»å¼€ä½œç”¨åŸŸæ—¶ææ„
    std::cout << "Main end\n";
    return 0;
}
```
> âœ… **è¾“å‡º**ï¼ˆ100% è°ƒç”¨ï¼‰ï¼š
> ```
> Construct 0
> Destruct 0
> Construct 1
> Destruct 1
> ...
> Main end
> ```

#### å®éªŒ 3ï¼šJava try-with-resourcesï¼ˆç°ä»£æ–¹æ¡ˆï¼‰
```java
// TryWithResources.java
import java.io.*;

public class TryWithResources {
    public static void main(String[] args) {
        try (FileInputStream file = new FileInputStream("data.txt")) {
            System.out.println("File opened");
            // è‡ªåŠ¨å…³é—­
        } catch (IOException e) {
            e.printStackTrace();
        }
        System.out.println("Main end");
    }
}
```
> âœ… **è¾“å‡º**ï¼ˆç¡®å®šæ€§å…³é—­ï¼‰ï¼š
> ```
> File opened
> Main end
> ```

---

### ğŸ“ å…­ã€åˆ†å±‚ç»ƒä¹ é¢˜

#### ğŸ”¹ åŸºç¡€é¢˜
1. **è°ƒç”¨ä¿è¯**  
   - è§£é‡Šä¸ºä½• C++ ææ„ 100% è°ƒç”¨ï¼ŒJava finalize() ä¸ä¿è¯

2. **å®˜æ–¹æ€åº¦**  
   - Java ä»å“ªä¸ªç‰ˆæœ¬å¼€å§‹å¼ƒç”¨ finalize()ï¼Ÿ

#### ğŸ”¸ è¿›é˜¶é¢˜
3. **ç°ä»£ Java æ›¿ä»£**  
   - ç”¨ try-with-resources é‡å†™ finalize() ç¤ºä¾‹

4. **C++ RAII å®ç°**  
   - å®ç°å¼‚å¸¸å®‰å…¨çš„ C++ æ–‡ä»¶ RAII ç±»

#### âš ï¸ é™·é˜±é¢˜ï¼ˆè¿ç§»è¯¯åŒºï¼‰
5. **â€œfinalize() èƒ½ç”¨äºç”Ÿäº§å§ï¼Ÿâ€**  
   - Q: Java finalize() èƒ½ç”¨äºå…³é”®èµ„æºé‡Šæ”¾å—ï¼Ÿ  
   - A: âŒ **ç»å¯¹ä¸èƒ½**ï¼  
     â†’ **Java å®˜æ–¹å·²å¼ƒç”¨**  
     â†’ **ä¸ä¿è¯è°ƒç”¨** â†’ èµ„æºæ³„æ¼é£é™©

6. **â€œC++ ææ„å’Œ finalize() ä¸€æ ·å§ï¼Ÿâ€**  
   - Q: C++ ææ„å‡½æ•°å’Œ Java finalize() åŠŸèƒ½ç›¸åŒå—ï¼Ÿ  
   - A: âŒ **æ ¹æœ¬ä¸åŒ**ï¼  
     â†’ C++ï¼š**ç¡®å®šæ€§ã€å¯é ã€ç²¾ç¡®**  
     â†’ Javaï¼š**éç¡®å®šæ€§ã€ä¸å¯é ã€ä¸ä¿è¯**

---

### âš ï¸ ä¸ƒã€æ³¨æ„äº‹é¡¹ä¸å»ºè®®

| é—®é¢˜ | å»ºè®® |
|------|------|
| **Java èµ„æºç®¡ç†** | ç”¨ try-with-resources / AutoCloseable |
| **C++ èµ„æºç®¡ç†** | ç”¨ RAIIï¼ˆunique_ptr, lock_guardï¼‰ |
| **finalize()** | **æ°¸ä¸ä½¿ç”¨**ï¼ˆJava 18+ å·²å¼ƒç”¨ï¼‰ |
| **ç°ä»£å®è·µ** | C++: RAII; Java: try-with-resources |

> ğŸ’¡ **ç°ä»£ C++/Java é»„é‡‘æ³•åˆ™**ï¼š  
> **â€œC++: RAII æ˜¯çœŸç†ï¼›Java: finalize() æ˜¯å†å²åƒåœ¾â€**

---

### ğŸ” å…«ã€èºæ—‹å¤ä¹ 

- **æ•´åˆ 2.3 å…¨ç³»åˆ—**ï¼šä»ææ„è¯­æ³• â†’ RAII å“²å­¦ â†’ èµ„æºç±»å‹ â†’ å¼‚å¸¸å®‰å…¨ â†’ **finalize() å¯¹æ¯”**
- **Java ç»éªŒ**ï¼šfinalize() æ˜¯ Java çš„è®¾è®¡å¤±è¯¯ï¼ŒC++ ææ„æ˜¯æ ¸å¿ƒä¼˜åŠ¿
- **å½“æ—¥å¤ä¹ **ï¼šé»˜å†™ C++ ä¸ Java èµ„æºç®¡ç†çš„ 3 å¤§å·®å¼‚

---

### ğŸ§  ä¹ã€ä¸»åŠ¨ learning ä»»åŠ¡

1. **è‡ªæˆ‘æé—®**ï¼š
   - â€œå¦‚ä½•å‘ Java å›¢é˜Ÿè§£é‡Š RAII çš„ä¼˜åŠ¿ï¼Ÿâ€
   - â€œC++23 å¦‚ä½•è¿›ä¸€æ­¥å¼ºåŒ– RAIIï¼Ÿâ€
2. **æ¦‚å¿µå›¾**ï¼šç”»å‡º C++ ä¸ Java èµ„æºç®¡ç†å…¨å¯¹æ¯”
3. **æ‰®æ¼”æ•™å¸ˆ**ï¼šå‘åŒäº‹è§£é‡Šâ€œä¸ºä»€ä¹ˆ finalize() è¢«å¼ƒç”¨â€

---

### ğŸ” åã€å¤ç›˜æ¸…å•

âœ… æˆ‘èƒ½è¯´å‡º C++ ææ„ä¸ Java finalize() çš„æ ¸å¿ƒå·®å¼‚  
âœ… æˆ‘ç†è§£ finalize() è¢«å¼ƒç”¨çš„åŸå›   
âœ… æˆ‘ä¼šç”¨ç°ä»£æ–¹æ¡ˆç®¡ç†èµ„æº  
âœ… æˆ‘çŸ¥é“å®˜æ–¹å¯¹ä¸¤ç§æœºåˆ¶çš„æ€åº¦  
âœ… æˆ‘æ˜ç™½ C++ RAII çš„ç¡®å®šæ€§ä¼˜åŠ¿

> ğŸ¯ **è¾¾æ ‡æ ‡å‡†**ï¼šå®ŒæˆåŸºç¡€é¢˜ + æ­£ç¡®åˆ†æé™·é˜±é¢˜ 5 å’Œ 6

---

## ğŸ‰ KU 2.3 å®Œæ•´é—­ç¯

ä½ å·²å®Œæ•´æŒæ¡ **KU 2.3ï¼šRAII èµ„æºç®¡ç†** çš„å…¨éƒ¨ 5 ä¸ªå­çŸ¥è¯†ç‚¹ï¼  
ä»ææ„å‡½æ•°è¯­æ³• â†’ RAII å“²å­¦ â†’ èµ„æºç±»å‹ â†’ å¼‚å¸¸å®‰å…¨ â†’ **ä¸ Java finalize() çš„ç»ˆæå¯¹æ¯”**ï¼Œå½¢æˆäº†**å®Œæ•´èµ„æºç®¡ç†è®¤çŸ¥ä½“ç³»**ã€‚

> ğŸ‰ **ä½ ç°åœ¨èƒ½**ï¼š
> - è®¾è®¡å¼‚å¸¸å®‰å…¨çš„ RAII ç±»
> - ç®¡ç†å†…å­˜ã€æ–‡ä»¶ã€é”ã€Socket ç­‰èµ„æº
> - å‘ Java åŒäº‹è§£é‡Š C++ çš„ç¡®å®šæ€§ä¼˜åŠ¿
> - å½»åº•æ‹¥æŠ± RAII å“²å­¦

---

## ğŸš€ ä¸‹ä¸€æ­¥å»ºè®®

ä½ å¯ä»¥é€‰æ‹©ï¼š

1. **ç»§ç»­å­¦ä¹  2.4 æ‹·è´æ„é€ å‡½æ•°ä¸æ‹·è´èµ‹å€¼è¿ç®—ç¬¦ï¼ˆæ·±æ‹·è´ vs æµ…æ‹·è´ï¼‰**
2. **è¯·æ±‚ç”Ÿæˆã€ŒC++ vs Java èµ„æºç®¡ç†é€ŸæŸ¥å¡ã€**
3. **å¯¼å‡º KU 2.3 ç»¼åˆå°æµ‹ï¼ˆ10 é“é¢˜ï¼‰**

è¯·å‘Šè¯‰æˆ‘ä½ çš„é€‰æ‹©ï¼Œæˆ‘ä»¬å°†ç»§ç»­å‰è¡Œï¼