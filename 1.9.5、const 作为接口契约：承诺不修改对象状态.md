å¤ªå¥½äº†ï¼æˆ‘ä»¬ç°åœ¨è¿›å…¥ **1.9.5ï¼šconst ä½œä¸ºæ¥å£å¥‘çº¦ â€” æ‰¿è¯ºä¸ä¿®æ”¹å¯¹è±¡çŠ¶æ€**ã€‚

è¿™æ˜¯ C++ **é¢å‘å¯¹è±¡è®¾è®¡**ä¸­çš„æ ¸å¿ƒåŸåˆ™ä¹‹ä¸€ã€‚ä½œä¸º Java å¼€å‘è€…ï¼Œä½ å¯èƒ½é€šè¿‡æ–‡æ¡£æˆ–æ³¨é‡Šçº¦å®šæ–¹æ³•ä¸ä¿®æ”¹å¯¹è±¡ï¼Œè€Œ C++ çš„ **`const` æˆå‘˜å‡½æ•°**å°†è¿™ä¸€çº¦å®š**æå‡ä¸ºç¼–è¯‘æœŸå¼ºåˆ¶å¥‘çº¦**ã€‚ç†è§£ `const` æˆå‘˜å‡½æ•°ï¼Œæ˜¯æŒæ¡ C++ **const æ­£ç¡®æ€§**ï¼ˆconst-correctnessï¼‰å’Œç¼–å†™å®‰å…¨ç±»è®¾è®¡çš„å…³é”®ã€‚

æˆ‘ä»¬å°†ç»§ç»­ä¸¥æ ¼éµå¾ªä½ çš„å­¦ä¹ åå¥½ï¼š
- âœ… SMART ç›®æ ‡  
- âœ… ç»“æ„å…ˆè¡Œï¼ˆconst å¥‘çº¦åœ°å›¾ï¼‰  
- âœ… ç”Ÿæ´»åŒ–æ¯”å–»  
- âœ… åŠ¨æ‰‹ä¸ºç‹ï¼ˆå«åŸºç¡€/è¿›é˜¶/é™·é˜±é¢˜ï¼‰  
- âœ… èºæ—‹å¤ä¹ ï¼ˆè¡”æ¥ 1.9.1â€“1.9.4 + Java ç»éªŒï¼‰  
- âœ… ä¸»åŠ¨å­¦ä¹  + å¤ç›˜

---

## ğŸ¯ KU 1.9.5ï¼šconst ä½œä¸ºæ¥å£å¥‘çº¦

> **æ‰€å±é˜¶æ®µ**ï¼šPhase 1 â€” C++ è¯­æ³•åŸºç¡€  
> **å‰ç½®çŸ¥è¯†**ï¼š1.9.1â€“1.9.4ï¼ˆconst å…¨ç³»åˆ—ï¼‰ã€1.6ï¼ˆstructï¼‰ã€Java ä¸å¯å˜è®¾è®¡ç»éªŒ  
> **åç»­è¡”æ¥**ï¼š2.10ï¼ˆconst æˆå‘˜å‡½æ•°è¯¦è§£ï¼‰ã€2.2ï¼ˆæ„é€ å‡½æ•°ï¼‰  
> **é¢„è®¡è€—æ—¶**ï¼š2â€“3 å°æ—¶

---

### ğŸ§­ ä¸€ã€ç»“æ„å…ˆè¡Œï¼šconst å¥‘çº¦åœ°å›¾

```
1.9.5 const ä½œä¸ºæ¥å£å¥‘çº¦
â”œâ”€â”€ 1. ä»€ä¹ˆæ˜¯ const æˆå‘˜å‡½æ•°ï¼Ÿ
â”‚   â”œâ”€â”€ 1.1 è¯­æ³•ï¼švoid f() const;
â”‚   â”œâ”€â”€ 1.2 ä½œç”¨ï¼šæ‰¿è¯ºä¸ä¿®æ”¹å¯¹è±¡ä»»ä½•é mutable æˆå‘˜
â”‚   â””â”€â”€ 1.3 this æŒ‡é’ˆï¼šconst T* const this
â”œâ”€â”€ 2. æ ¸å¿ƒè§„åˆ™
â”‚   â”œâ”€â”€ 2.1 const å¯¹è±¡åªèƒ½è°ƒç”¨ const æˆå‘˜å‡½æ•°
â”‚   â”œâ”€â”€ 2.2 const æˆå‘˜å‡½æ•°å†…ä¸èƒ½è°ƒç”¨é const æˆå‘˜
â”‚   â””â”€â”€ 2.3 mutable æˆå‘˜ä¾‹å¤–ï¼ˆå¯ä¿®æ”¹ï¼‰
â”œâ”€â”€ 3. è®¾è®¡æ„ä¹‰
â”‚   â”œâ”€â”€ 3.1 æ¥å£å¥‘çº¦ï¼ˆç¼–è¯‘æœŸå¼ºåˆ¶ï¼‰
â”‚   â”œâ”€â”€ 3.2 æ”¯æŒ const æ­£ç¡®æ€§ï¼ˆconst-correctnessï¼‰
â”‚   â””â”€â”€ 3.3 ä¸ Java çš„å¯¹æ¯”ï¼ˆæ–‡æ¡£çº¦å®š vs ç¼–è¯‘æœŸä¿è¯ï¼‰
â”œâ”€â”€ 4. å¸¸è§ç”¨é€”
â”‚   â”œâ”€â”€ 4.1 getter æ–¹æ³•
â”‚   â”œâ”€â”€ 4.2 æŸ¥è¯¢/è®¡ç®—æ–¹æ³•
â”‚   â””â”€â”€ 4.3 æ“ä½œç¬¦é‡è½½ï¼ˆ<<, ==ï¼‰
â”œâ”€â”€ 5. é™·é˜±ä¸æœ€ä½³å®è·µ
    â”œâ”€â”€ 5.1 å¿˜è®° const å¯¼è‡´æ¥å£å—é™
    â”œâ”€â”€ 5.2 è¯¯ç”¨ mutable ç ´åä¸å¯å˜æ€§
    â””â”€â”€ 5.3 ç°ä»£ C++ å»ºè®®ï¼šgetter é»˜è®¤ const
```

---

### ğŸ¯ äºŒã€SMART å­¦ä¹ ç›®æ ‡

- **Specific**ï¼šèƒ½æ­£ç¡®å®šä¹‰ `const` æˆå‘˜å‡½æ•°ï¼Œç†è§£å…¶ä½œä¸ºæ¥å£å¥‘çº¦çš„ä½œç”¨ï¼Œå¹¶é¿å…å¸¸è§é”™è¯¯ã€‚
- **Measurable**ï¼šå®Œæˆ 2 é“åŸºç¡€é¢˜ + 2 é“é™·é˜±é¢˜ï¼Œèƒ½è§£é‡Šä¸ºä½• `const` å¯¹è±¡ä¸èƒ½è°ƒç”¨é `const` å‡½æ•°ã€‚
- **Achievable**ï¼šé€šè¿‡â€œåªè¯»åˆåŒâ€æ¯”å–»ç†è§£ const å¥‘çº¦ã€‚
- **Relevant**ï¼šè¿™æ˜¯ç¼–å†™å®‰å…¨ã€å¯å¤ç”¨ C++ ç±»çš„åŸºç¡€ã€‚
- **Time-bound**ï¼š1â€“2 å¤©å†…å®Œæˆã€‚

---

### ğŸŒ ä¸‰ã€ç”Ÿæ´»åŒ–æ¯”å–»ï¼šåªè¯»åˆåŒ

> æƒ³è±¡ä½ ç­¾ç½²ä¸€ä»½**æœåŠ¡åˆåŒ**ï¼š
>
> - **æ™®é€šå‡½æ•°** = **å…¨æƒåˆåŒ**  
>   - æœåŠ¡å•†å¯ä¿®æ”¹ä½ çš„ä»»ä½•æ•°æ®  
>   - é£é™©ï¼šæ„å¤–ä¿®æ”¹
>
> - **const æˆå‘˜å‡½æ•°** = **åªè¯»åˆåŒ**  
>   - æœåŠ¡å•†**æ‰¿è¯ºä¸ä¿®æ”¹**ä½ çš„æ•°æ®  
>   - å®‰å…¨ï¼šç¼–è¯‘å™¨å¼ºåˆ¶æ‰§è¡Œ
>
> - **const å¯¹è±¡** = **åªè¯»è´¦æˆ·**  
>   - åªèƒ½è°ƒç”¨â€œåªè¯»åˆåŒâ€æœåŠ¡  
>   - æ— æ³•è°ƒç”¨â€œå…¨æƒåˆåŒâ€ï¼ˆç¼–è¯‘é”™è¯¯ï¼‰
>
> - **Java å¯¹æ¯”**ï¼š  
>   - Java ä¾èµ–**æ–‡æ¡£çº¦å®š**ï¼ˆâ€œæ­¤æ–¹æ³•ä¸ä¿®æ”¹çŠ¶æ€â€ï¼‰  
>   - **C++ ç”¨ const ç¼–è¯‘æœŸå¼ºåˆ¶**ï¼Œæ— æ³•ç»•è¿‡

> ğŸ’¡ **å…³é”®è®¤çŸ¥**ï¼š**`const` æˆå‘˜å‡½æ•°æ˜¯ C++ çš„ç¼–è¯‘æœŸæ¥å£å¥‘çº¦ â€”â€” æ— æ³•è¿åï¼Œæ— éœ€ä¿¡ä»»**ã€‚

---

### ğŸ“š å››ã€çŸ¥è¯†ç‚¹åˆ†è§£

#### 1. ä»€ä¹ˆæ˜¯ const æˆå‘˜å‡½æ•°ï¼Ÿ
- **è¯­æ³•**ï¼š
  ```cpp
  class MyClass {
  public:
      int get_value() const; // const æˆå‘˜å‡½æ•°
  };
  ```
- **ä½œç”¨**ï¼š
  - æ‰¿è¯º**ä¸ä¿®æ”¹å¯¹è±¡ä»»ä½•é `mutable` æˆå‘˜**
  - å…è®¸**`const` å¯¹è±¡è°ƒç”¨**
- **`this` æŒ‡é’ˆ**ï¼š
  - æ™®é€šæˆå‘˜å‡½æ•°ï¼š`MyClass* const this`
  - `const` æˆå‘˜å‡½æ•°ï¼š`const MyClass* const this`

#### 2. æ ¸å¿ƒè§„åˆ™
- **const å¯¹è±¡åªèƒ½è°ƒç”¨ const æˆå‘˜**ï¼š
  ```cpp
  const MyClass obj;
  obj.get_value(); // OK
  // obj.set_value(42); // é”™è¯¯ï¼é const å‡½æ•°
  ```
- **const å‡½æ•°å†…ä¸èƒ½è°ƒç”¨é const æˆå‘˜**ï¼š
  ```cpp
  int get_double() const {
      // set_value(value_ * 2); // é”™è¯¯ï¼set_value é const
      return value_ * 2; // OKï¼ˆåªè¯»ï¼‰
  }
  ```
- **`mutable` æˆå‘˜ä¾‹å¤–**ï¼š
  ```cpp
  class Cache {
      mutable int cached_value_;
      mutable bool valid_;
  public:
      int get_value() const {
          if (!valid_) {
              cached_value_ = expensive_calc(); // OKï¼mutable
              valid_ = true;
          }
          return cached_value_;
      }
  };
  ```

#### 3. è®¾è®¡æ„ä¹‰
- **æ¥å£å¥‘çº¦**ï¼š
  - ç”¨æˆ·çœ‹åˆ° `const` å‡½æ•° â†’ çŸ¥é“ä¸ä¿®æ”¹å¯¹è±¡
  - ç¼–è¯‘å™¨å¼ºåˆ¶ â†’ æ— æ³•æ„å¤–è¿å
- **const æ­£ç¡®æ€§**ï¼š
  - ä¸€æ—¦å¯¹è±¡æ ‡è®° `const`ï¼Œæ•´ä¸ªè°ƒç”¨é“¾å¿…é¡» `const`
  - ä¿ƒè¿›ä¸å¯å˜è®¾è®¡
- **ä¸ Java å¯¹æ¯”**ï¼š
  | ç‰¹æ€§ | C++ | Java |
  |------|-----|------|
  | **ä¸å¯å˜ä¿è¯** | ç¼–è¯‘æœŸå¼ºåˆ¶ï¼ˆ`const`ï¼‰ | è¿è¡ŒæœŸä¾èµ–ï¼ˆä¸å¯å˜å¯¹è±¡è®¾è®¡ï¼‰ |
  | **æ¥å£æ ‡è®°** | `const` å…³é”®å­— | æ— ï¼ˆé æ–‡æ¡£/æ³¨é‡Šï¼‰ |
  | **ç¼“å­˜æ”¯æŒ** | `mutable` | éœ€ volatile/åŒæ­¥ |

#### 4. å¸¸è§ç”¨é€”
- **Getter æ–¹æ³•**ï¼š
  ```cpp
  class Point {
      double x_, y_;
  public:
      double x() const { return x_; } // const getter
      double y() const { return y_; }
  };
  ```
- **æŸ¥è¯¢/è®¡ç®—æ–¹æ³•**ï¼š
  ```cpp
  double distance_from_origin() const {
      return std::sqrt(x_*x_ + y_*y_);
  }
  ```
- **æ“ä½œç¬¦é‡è½½**ï¼š
  ```cpp
  bool operator==(const Point& other) const {
      return x_ == other.x_ && y_ == other.y_;
  }
  ```

#### 5. é™·é˜±ä¸æœ€ä½³å®è·µ
- **å¿˜è®° const**ï¼š
  ```cpp
  // é”™è¯¯ï¼šgetter åº”ä¸º const
  int get_value() { return value_; }
  
  const MyClass obj;
  // obj.get_value(); // é”™è¯¯ï¼
  ```
- **è¯¯ç”¨ mutable**ï¼š
  ```cpp
  class Bad {
      mutable int x_;
  public:
      void set_x(int x) const { x_ = x; } // ç ´å const è¯­ä¹‰ï¼
  };
  ```
- **ç°ä»£ C++ å»ºè®®**ï¼š
  - **Getter é»˜è®¤ const**
  - **æŸ¥è¯¢æ–¹æ³•é»˜è®¤ const**
  - **ä»…å½“çœŸæ­£éœ€è¦ä¿®æ”¹æ—¶ï¼Œæ‰ç”¨ mutable**

> ğŸ’¡ **ç°ä»£ C++ é»„é‡‘æ³•åˆ™**ï¼š  
> **â€œGetter å’ŒæŸ¥è¯¢æ–¹æ³•å¿…é¡» constï¼›mutable ä»…ç”¨äºç¼“å­˜/è°ƒè¯•â€**

---

### ğŸ’» äº”ã€åŠ¨æ‰‹ä¸ºç‹ï¼šå¯è¿è¡Œç¤ºä¾‹

#### ç¤ºä¾‹ 1ï¼šconst æˆå‘˜å‡½æ•°åŸºç¡€
```cpp
#include <iostream>
#include <cmath>

class Point {
    double x_, y_;
public:
    Point(double x, double y) : x_(x), y_(y) {}
    
    // const getter
    double x() const { return x_; }
    double y() const { return y_; }
    
    // const æŸ¥è¯¢æ–¹æ³•
    double distance() const {
        return std::sqrt(x_*x_ + y_*y_);
    }
    
    // é const setter
    void set_x(double x) { x_ = x; }
    void set_y(double y) { y_ = y; }
};

int main() {
    const Point p(3.0, 4.0); // const å¯¹è±¡
    
    std::cout << "x: " << p.x() << "\n"; // OK
    std::cout << "distance: " << p.distance() << "\n"; // OK
    
    // p.set_x(5.0); // é”™è¯¯ï¼é const å‡½æ•°
    
    Point p2(1.0, 1.0); // é const å¯¹è±¡
    p2.set_x(2.0); // OK
    std::cout << "p2.x: " << p2.x() << "\n"; // OK
    
    return 0;
}
```

#### ç¤ºä¾‹ 2ï¼šmutable ç¼“å­˜ï¼ˆå®‰å…¨ç”¨æ³•ï¼‰
```cpp
#include <iostream>

class ExpensiveCalc {
    mutable int last_input_;
    mutable int last_result_;
    mutable bool valid_;
    
    int calculate(int x) const {
        std::cout << "Calculating for " << x << "\n";
        return x * x;
    }
    
public:
    ExpensiveCalc() : valid_(false) {}
    
    int get(int x) const {
        if (!valid_ || last_input_ != x) {
            last_result_ = calculate(x); // OKï¼šmutable
            last_input_ = x;
            valid_ = true;
        }
        return last_result_;
    }
};

int main() {
    const ExpensiveCalc calc;
    std::cout << "Result: " << calc.get(5) << "\n"; // è®¡ç®—
    std::cout << "Result: " << calc.get(5) << "\n"; // ç¼“å­˜
    return 0;
}
```

#### ç¤ºä¾‹ 3ï¼šconst æ­£ç¡®æ€§é“¾
```cpp
#include <iostream>

class Inner {
public:
    void non_const_func() { std::cout << "Non-const\n"; }
    void const_func() const { std::cout << "Const\n"; }
};

class Outer {
    Inner inner_;
public:
    void call_non_const() const {
        // inner_.non_const_func(); // é”™è¯¯ï¼inner_ æ˜¯ const Inner
        inner_.const_func(); // OK
    }
};

int main() {
    const Outer o;
    o.call_non_const(); // OK
    return 0;
}
```

---

### ğŸ“ å…­ã€åˆ†å±‚ç»ƒä¹ é¢˜

#### ğŸ”¹ åŸºç¡€é¢˜
1. **const å‡½æ•°å£°æ˜**  
   - ä¸º `class Rectangle { double width_, height_; };` æ·»åŠ  `area() const`

2. **const å¯¹è±¡è°ƒç”¨**  
   - åˆ›å»º `const Rectangle r(2, 3);`ï¼Œè°ƒç”¨ `area()`

#### ğŸ”¸ è¿›é˜¶é¢˜
3. **æ“ä½œç¬¦é‡è½½**  
   - ä¸º `Rectangle` å®ç° `operator==`ï¼Œä½¿ç”¨ `const` å‚æ•°å’Œ `const` å‡½æ•°

4. **mutable ç¼“å­˜**  
   - ä¸º `Rectangle` æ·»åŠ å‘¨é•¿ç¼“å­˜ï¼ˆmutableï¼‰

#### âš ï¸ é™·é˜±é¢˜ï¼ˆJava è¿ç§»è¯¯åŒºï¼‰
5. **â€œconst å‡½æ•°èƒ½è°ƒç”¨ä»»ä½•å‡½æ•°å§ï¼Ÿâ€**  
   - Q: `const` æˆå‘˜å‡½æ•°èƒ½è°ƒç”¨é `const` æˆå‘˜å‡½æ•°å—ï¼Ÿ  
   - A: âŒ **ä¸èƒ½**ï¼  
     â†’ ä¼šç ´å const å¥‘çº¦ â†’ **ç¼–è¯‘é”™è¯¯**

6. **â€œJava ä¹Ÿæœ‰ const å§ï¼Ÿâ€**  
   - Q: Java çš„ `final` æ–¹æ³•ç­‰ä»·äº C++ `const` å‡½æ•°å—ï¼Ÿ  
   - A: âŒ **ä¸ç­‰ä»·**ï¼  
     - Java `final` = **ä¸èƒ½è¢«é‡å†™**  
     - C++ `const` = **ä¸ä¿®æ”¹å¯¹è±¡çŠ¶æ€**  
     â†’ C++ ç”¨ `final` å…³é”®å­—ç¦æ­¢é‡å†™ï¼ˆPhase 2ï¼‰

---

### âš ï¸ ä¸ƒã€æ³¨æ„äº‹é¡¹ä¸å»ºè®®

| é—®é¢˜ | å»ºè®® |
|------|------|
| **Getter** | é»˜è®¤æ ‡è®° `const` |
| **mutable** | ä»…ç”¨äºç¼“å­˜ã€è°ƒè¯•ã€çº¿ç¨‹å®‰å…¨è®¡æ•° |
| **const æ­£ç¡®æ€§** | ä¸€æ—¦å¼€å§‹ï¼Œæ•´ä¸ªè°ƒç”¨é“¾éœ€ const |
| **è®¾è®¡åŸåˆ™** | ä¼˜å…ˆä¸å¯å˜æ¥å£ï¼ˆconstï¼‰ |
| **ç°ä»£å®è·µ** | æ“ä½œç¬¦é‡è½½é»˜è®¤ const |

> ğŸ’¡ **ç°ä»£ C++ é»„é‡‘æ³•åˆ™**ï¼š  
> **â€œGetter å’ŒæŸ¥è¯¢æ–¹æ³•å¿…é¡» constï¼›mutable æ˜¯ç‰¹ä¾‹ï¼Œéé»˜è®¤â€**

---

### ğŸ” å…«ã€èºæ—‹å¤ä¹ 

- **è¡”æ¥ 1.9.4**ï¼šå‡½æ•°å‚æ•° `const T&` vs æˆå‘˜å‡½æ•° `const`
- **è¡”æ¥ 2.10**ï¼šconst æˆå‘˜å‡½æ•°æ˜¯ Phase 2 çš„æ ¸å¿ƒ
- **Java ç»éªŒ**ï¼šC++ æä¾›ç¼–è¯‘æœŸä¸å¯å˜ä¿è¯
- **å½“æ—¥å¤ä¹ **ï¼šé»˜å†™ const æˆå‘˜å‡½æ•°çš„ä¸‰å¤§è§„åˆ™

---

### ğŸ§  ä¹ã€ä¸»åŠ¨å­¦ä¹ ä»»åŠ¡

1. **è‡ªæˆ‘æé—®**ï¼š
   - â€œä¸ºä»€ä¹ˆ const æˆå‘˜å‡½æ•°çš„ this æ˜¯ const T* constï¼Ÿâ€
   - â€œå¦‚ä½•è®¾è®¡ä¸€ä¸ªå®Œå…¨ä¸å¯å˜çš„ç±»ï¼Ÿâ€
2. **æ¦‚å¿µå›¾**ï¼šç”»å‡º const å¯¹è±¡è°ƒç”¨é“¾çš„çº¦æŸ
3. **æ‰®æ¼”æ•™å¸ˆ**ï¼šå‘åŒäº‹è§£é‡Šâ€œä¸ºä»€ä¹ˆ getter å¿…é¡» constâ€

---

### ğŸ” åã€å¤ç›˜æ¸…å•

âœ… æˆ‘èƒ½æ­£ç¡®å®šä¹‰ const æˆå‘˜å‡½æ•°  
âœ… æˆ‘ç†è§£ const ä½œä¸ºæ¥å£å¥‘çº¦çš„ä½œç”¨  
âœ… æˆ‘ä¼šç”¨ mutable å®‰å…¨ç¼“å­˜  
âœ… æˆ‘çŸ¥é“ä¸ Java final çš„å·®å¼‚  
âœ… æˆ‘æ˜ç™½ç°ä»£ C++ çš„ const è®¾è®¡åŸåˆ™

> ğŸ¯ **è¾¾æ ‡æ ‡å‡†**ï¼šå®ŒæˆåŸºç¡€é¢˜ + æ­£ç¡®åˆ†æé™·é˜±é¢˜ 5 å’Œ 6

---

## ğŸš€ ä¸‹ä¸€æ­¥å»ºè®®

ä½ å·²æŒæ¡ **C++ const æ¥å£å¥‘çº¦çš„æ ¸å¿ƒçŸ¥è¯†**ï¼

æ¥ä¸‹æ¥ä½ å¯ä»¥ï¼š
1. **ç»§ç»­å­¦ä¹  1.9.6 ä¸ Java final å¯¹æ¯”ï¼šconst æ˜¯å¥‘çº¦ï¼Œä¸æ˜¯ä¿®é¥°**
2. **è¯·æ±‚ç”Ÿæˆã€ŒC++ const æˆå‘˜å‡½æ•°é€ŸæŸ¥å¡ã€**
3. **è·³è½¬åˆ°ç»ƒä¹ é¢˜ç­”æ¡ˆä¸è§£æ**

è¯·å‘Šè¯‰æˆ‘ä½ çš„é€‰æ‹©ï¼Œæˆ‘ä»¬å°†ç»§ç»­å‰è¡Œï¼