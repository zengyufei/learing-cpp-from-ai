## **if-else 条件语句语法与嵌套结构**

---

#### **本阶段学习目标**  
1. 掌握 `if`、`if-else`、`else if` 链的基本语法、执行流程与缩进规范；  
2. 理解“悬空 else（dangling else）”问题及其解决方案（强制使用花括号）；  
3. 能编写多级条件判断程序（如成绩评级、菜单选择），逻辑清晰无歧义；  
4. 建立“条件覆盖”意识：确保所有可能分支均有处理，避免遗漏；  
5. 初步形成防御性条件编写习惯：复杂条件拆分为布尔变量，提升可读性与可测性。

---

#### **本阶段知识点分解**

##### 1. **if-else 基本语法与执行模型**
- **单分支 `if`**：
  ```cpp
  if (condition) {
      // condition 为 true 时执行
  }
  ```
- **双分支 `if-else`**：
  ```cpp
  if (condition) {
      // true 分支
  } else {
      // false 分支
  }
  ```
- **多分支 `else if` 链**：
  ```cpp
  if (cond1) {
      // ...
  } else if (cond2) {
      // ...
  } else {
      // 默认分支
  }
  ```
- **执行流程**：  
  - 从上到下依次检查条件；  
  - 一旦某个 `if` 或 `else if` 条件为 `true`，执行对应块并**跳过后续所有分支**；  
  - 若全为 `false`，且存在 `else`，则执行 `else` 块。

##### 2. **悬空 else 问题与花括号强制规范**
- **问题场景**（无花括号时）：
  ```cpp
  if (a > 0)
      if (b > 0)
          std::cout << "Both positive\n";
      else
          std::cout << "b not positive\n"; // 此 else 属于内层 if！
  ```
- **C++ 规则**：`else` 总是与**最近的、未配对的 `if`** 配对；  
- **解决方案**：**始终使用花括号 `{}`**，即使单行语句；  
- **风格规范**（Google C++ Style）：  
  > “即使只有一行，也必须用花括号——避免未来修改时引入悬空 else。”

##### 3. **多级条件设计原则**
- **互斥性**：各 `else if` 条件应互不重叠；  
- **完备性**：应有 `else` 处理默认或错误情况；  
- **顺序敏感**：条件顺序影响执行路径（高优先级条件放前）；  
- **生活化比喻**：  
  > “`else if` 链像医院分诊台：  
  > - 先问‘是否呼吸困难’（紧急）；  
  > - 再问‘是否发烧’（次紧急）；  
  > - 最后‘其他症状’（普通）。  
  > 顺序错了，可能误判。”

##### 4. **常见错误与陷阱**
- ❌ **省略花括号导致逻辑错**（悬空 else）；  
- ❌ **条件重叠**：如 `score > 90` 和 `score > 80` 同时为真，但只执行第一个；  
- ❌ **遗漏边界值**：如 `score == 90` 未被任何条件覆盖；  
- ❌ **在条件中赋值**：`if (x = 5)`（应为 `==`），编译器可能仅警告。

##### 5. **可读性提升技巧**
- **复杂条件拆分**：
  ```cpp
  bool is_adult = (age >= 18);
  bool has_license = (license_status == "valid");
  if (is_adult && has_license) { ... }
  ```
- **注释说明分支意图**：
  ```cpp
  } else if (score >= 70) {
      // C grade: passing but needs improvement
      std::cout << "C\n";
  }
  ```

---

#### **本阶段动手练习任务**

- **【基础任务】单/双分支实践（30 分钟）**  
  1. 编写程序：输入整数，若为正数输出“Positive”，否则输出“Non-positive”；  
  2. 编写程序：输入年龄，若 ≥18 输出“Adult”，否则“Minor”；  
  3. 故意省略花括号，制造悬空 else，观察行为差异。

- **【进阶任务】多级成绩评级（40 分钟）**  
  - 功能：输入 0–100 分数，输出等级：  
    - 90–100: A  
    - 80–89: B  
    - 70–79: C  
    - 60–69: D  
    - 0–59: F  
  - 要求：  
    - 使用 `else if` 链；  
    - 包含 `else` 处理无效分数（如 <0 或 >100）；  
    - 条件边界清晰（如 `score >= 90` 而非 `score > 89`）。

- **【陷阱任务】条件重叠与边界遗漏（20 分钟）**  
  1. 提供错误代码：
     ```cpp
     if (score > 80) std::cout << "B\n";
     if (score > 90) std::cout << "A\n"; // 错！应为 else if
     ```
     要求：输入 95，观察输出“B\nA\n”，修复为 `else if`；  
  2. 测试边界：输入 90、80、70 等，验证是否被正确分类。

---

#### **跨阶段综合小测/项目**  
- 本阶段 `if-else` 能力将直接用于 **03:00–04:30 的输入验证重试机制**：  
  - 学生需用 `if` 判断输入是否有效，结合 `while` 实现重试；  
- 同时支撑 **15:00–16:30 的猜数字游戏** 中的“太大/太小”提示逻辑。

---

#### **与前后阶段的知识衔接说明**

- **前置依赖**：00:00–01:30 阶段已深化布尔表达式与短路求值，本阶段将其**转化为语法结构**；  
- **后继支撑**：  
  - 03:00–04:30 将 `if` 与 `while` 结合，实现健壮输入；  
  - 07:30–09:00 的编码训练将包含闰年判断等复杂 `if` 逻辑；  
- **螺旋上升点**：  
  - 第 3 周“函数封装”将把成绩评级逻辑提取为独立函数；  
  - 第 10 周“异常处理”将回溯 `else` 作为错误处理的最后防线。

--- 

> 本阶段是程序从“线性执行”迈向“智能决策”的第一步。必须通过亲手编写多级条件、制造并修复悬空 else，建立对分支结构的精确控制感。花括号不是可选项，而是防御未来错误的铠甲。