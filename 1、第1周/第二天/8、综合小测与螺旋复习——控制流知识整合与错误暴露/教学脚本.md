## **综合小测与螺旋复习——控制流知识整合与错误暴露**  

---

### 【第 1 步：复习唤醒——5 个问题，激活你的控制流脑】（10:30–10:45）

> 同学，过去 10 个半小时，你已经掌握了 C++ 控制流的“决策与重复”能力。  
>  
> 现在，我们不做新知识，而是**快速唤醒记忆**。请回答以下 5 个问题（每题思考 1 分钟）：

> **Q 1**：`while` 和 `for` 的主要区别是什么？何时用哪个？  
> → （等待）答案：`for` 用于已知次数，三要素集中；`while` 用于未知次数，条件驱动。

> **Q 2**：什么是“悬空 else”？如何避免？  
> → 答：`else` 与最近 `if` 配对导致逻辑错；避免方法：**始终用花括号**。

> **Q 3**：在 `while` 中用 `continue`，为什么容易无限循环？  
> → 答：因为 `continue` 跳过后续代码，若循环变量更新在 `continue` 之后，则永不更新。

> **Q 4**：`break` 和 `continue` 在嵌套循环中影响哪一层？  
> → 答：**只影响最内层循环**。

> **Q 5**：闰年的完整条件是什么？  
> → 答：`(y%4==0 && y%100!=0) || (y%400==0)`

> 如果你答对 4 个以上，说明控制流基础扎实；如果卡壳，别担心——接下来的小测会帮你暴露问题。

---

### 【第 2 步：小测说明——这不是考试，是“控制流体检”】（10:45–10:50）

> 接下来 90 分钟，我们要做一次 **C++ 控制流“体检”**：  
> - 不是为了打分，而是为了**发现隐患**；  
> - 错了没关系，**发现错误就是进步**；  
> - 所有任务都基于你今天学过的内容，没有超纲。

> 我们分三部分：
> 1. **编程任务**：写一个带重试的交互式菜单系统；  
> 2. **错误修复**：修复一段“病态菜单代码”；  
> 3. **即时反馈**：我会告诉你哪里容易错，为什么错。

> 准备好了吗？我们开始实战。

---

### 【第 3 步：编程实战——交互式菜单系统（45 分钟）】（10:50–11:35）

> **任务要求**：  
> - 显示菜单：1. 问候 2. 单位转换 3. 退出；  
> - 无效选项或非数字输入，提示重试；  
> - 选择 1：输入姓名+年龄，输出问候；  
> - 选择 2：输入英寸，输出厘米（1 in = 2.54 cm）；  
> - 选择 3：退出程序；  
> - **必须使用 `while (true)` + `break` 实现主循环**。

> **示范正确结构**：
> ```cpp
> #include <iostream>
> #include <string>
> 
> int main() {
>     while (true) {
>         std::cout << "\n1. Greet  2. Convert  3. Exit\n";
>         std::cout << "Choose (1-3): ";
>         
>         int choice;
>         std::cin >> choice;
>         
>         if (std::cin.fail()) {
>             std::cin.clear();
>             std::cin.ignore(1000, '\n');
>             std::cout << "Invalid input! Try again.\n";
>             continue;
>         }
>         
>         if (choice == 1) {
>             std::string name;
>             int age;
>             std::cout << "Name: "; std::cin >> name;
>             std::cout << "Age: "; std::cin >> age;
>             std::cout << "Hello " << name << ", age " << age << "!\n";
>         } 
>         else if (choice == 2) {
>             double inches;
>             std::cout << "Inches: "; std::cin >> inches;
>             if (std::cin.fail()) {
>                 std::cin.clear();
>                 std::cin.ignore(1000, '\n');
>                 std::cout << "Invalid number!\n";
>                 continue;
>             }
>             std::cout << "Centimeters: " << inches * 2.54 << "\n";
>         } 
>         else if (choice == 3) {
>             std::cout << "Goodbye!\n";
>             break; // 退出主循环
>         } 
>         else {
>             std::cout << "Option must be 1, 2, or 3.\n";
>         }
>     }
>     return 0;
> }
> ```

> **常见陷阱提醒**：  
> - ❌ 忘记 `#include <string>`；  
> - ❌ `if (choice = 1)`（赋值而非比较）；  
> - ❌ `cin.fail()` 后未 `clear()` / `ignore()`，导致无限循环；  
> - ❌ 无输入提示，用户体验差。

> 现在，请你独立编写并测试程序。  
> **目标不是快，而是准**。

---

### 【第 4 步：错误修复挑战——给“病菜单”做手术】（11:35–11:55）

> 现在看这段“病代码”：
> ```cpp
> #include <iostream>
> int main() {
>     while (true) {
>         std::cout << "1. Hello 2. Convert 3. Exit: ";
>         int choice;
>         std::cin >> choice;
>         if (choice = 1) { // 错1
>             std::string name; int age;
>             std::cin >> name >> age;
>             std::cout << "Hi " << name << ", age " << age << "\n";
>         } else if (choice == 2) {
>             double in;
>             std::cin >> in;
>             if (std::cin.fail()) continue; // 错2
>             std::cout << "cm: " << in * 2.54 << "\n";
>         } else if (choice == 3) {
>             break;
>         } else {
>             std::cout << "Invalid\n";
>         }
>     }
> }
> ```

> **你的任务**：  
> 1. 复制到编辑器，尝试编译运行；  
> 2. 记录每处错误现象（如编译失败、无限循环）；  
> 3. 逐条修复，直到程序能正确运行。

> **提示：它有 5 处错误**：  
> - 语法/编译错误（2 处）；  
> - 逻辑错误（2 处）；  
> - 风格/体验缺陷（1 处）。

> 这不是刁难你——**这些错误，90% 的初学者都会犯**。  
> 今天暴露，总比明天在项目里崩溃强。

---

### 【第 5 步：即时反馈——为什么 cin.Fail () 后必须 clear ()？】（11:55–11:58）

> 如果你输入 `abc` 给 `int choice`，会发生：  
> 1. `cin` 进入 **fail 状态**；  
> 2. 后续所有 `cin >>` 都失败；  
> 3. 如果只 `continue`，循环会**无限打印“Invalid”**。  
>  
> **正确做法**：  
> ```cpp
> if (std::cin.fail()) {
>     std::cin.clear();        // 重置 fail 状态
>     std::cin.ignore(1000, '\n'); // 跳过无效输入
>     continue;
> }
> ```
>  
> **记住**：**`cin.fail()` 是症状，`clear()` + `ignore()` 是药**。  
> 只吃一半，病不会好。

---

### 【第 6 步：总结 + 衔接下一阶段】（11:58–12:00）

> 今天我们完成了 C++ 控制流的第一个“闭环检验”：  
>  
> ✅ 回顾了核心概念；  
> ✅ 实战了完整菜单系统；  
> ✅ 修复了典型控制流错误。  
>  
> 无论你做得多好或多差，**暴露问题就是胜利**。  
>  
> 接下来（12:00–13:30），我们将进入 **代码风格与可读性训练**：  
> - 用 Google C++ Style Guide 重构你的菜单系统；  
> - 学习命名规范、缩进、注释；  
> - 让代码不仅“能跑”，而且“好看、好维护”。  
>  
> 而你今天写的每一行代码，都将成为重构的素材。  
>  
> 准备好从“能写”迈向“写好”了吗？我们继续。

---

> 📌 **教学原则达成检查**：  
> - ✅ 结构先行：以“回顾 → 编程 → 修复 → 反馈”为闭环流程；  
> - ✅ 生活化比喻：“体检”“病菜单手术”降低测试焦虑；  
> - ✅ 动手为王：两项核心任务（菜单系统 + 错误修复）；  
> - ✅ 防错前置：聚焦 5 类典型错误，强制暴露理解漏洞；  
> - ✅ 衔接清晰：为下一阶段“代码风格”提供真实重构对象。
