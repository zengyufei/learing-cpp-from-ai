## **控制流核心价值与布尔逻辑深化**  

---

### 【第 1 步：问题引入——你的程序能“做决定”吗？】（00:00–00:10）

> 同学，昨天你写的单位转换器很完美——但有一个致命缺陷：  
>  
> **它不会“思考”**。  
>  
> 如果用户输错选项，它就直接退出；  
> 如果你想让它“根据温度自动判断冷热”，它做不到。  
>  
> 为什么？因为昨天的程序是**顺序执行**的——像一条笔直的铁路，没有岔道。  
>  
> 今天，我们要给它装上**道岔和环岛**，让它能：  
> - **做选择**（if）；  
> - **重复做事**（while/for）。  
>  
> 而这一切的起点，是**布尔逻辑的深化**。  
>  
> 准备好让你的程序从“录音机”变成“智能体”了吗？

---

### 【第 2 步：顺序执行的局限——现实世界需要分支】（00:10–00:20）

> 回顾你昨天的代码：
> ```cpp
> std::cin >> choice;
> if (choice == 1) { ... } // ← 等等，你还没学 if！
> ```
>  
> 实际上，你只能写：
> ```cpp
> // 固定模式，无法动态响应
> double c = (f - 32) * 5.0 / 9.0;
> ```
>  
> **现实需求 vs 程序能力**：  
> - 用户想要：**“输错能重试”** → 需要循环；  
> - 系统需要：**“年龄≥18 才允许注册”** → 需要条件判断。  
>  
> **生活化比喻**：  
> > “顺序程序像直行列车——从 A 到 B，不能拐弯；  
> > 控制流程序像自动驾驶汽车——遇红灯停，见出口转，环岛绕行。”  
>  
> 今天，我们先不写 `if`，而是**先理解它依赖的“决策语言”——布尔逻辑**。

---

### 【第 3 步：布尔逻辑深化——不只是 true/false】（00:20–00:35）

> 你已经知道 `&&`（与）、`||`（或）、`!`（非）。  
>  
> 但它们的**求值顺序和行为**，藏着关键细节：

> **优先级**：  
> `!` 最高，`&&` 次之，`||` 最低。  
> 所以：
> ```cpp
> bool r = a || b && c; // 等价于 a || (b && c)
> ```
>  
> **但更关键的是——短路求值**。

---

### 【第 4 步：短路求值——C++ 的“懒人智慧”】（00:35–00:50）

> **规则**：  
> - `A && B`：如果 `A` 是 `false`，**B 根本不会算**；  
> - `A || B`：如果 `A` 是 `true`，**B 根本不会算**。

> **为什么重要**？看这个例子：
> ```cpp
> if (ptr != nullptr && ptr->isValid()) { ... }
> ```
> 如果 `ptr` 是空指针，`ptr->isValid()` 会崩溃。  
> 但因为短路，**当 `ptr != nullptr` 为 false 时，右边根本不会执行**——安全！

> **副作用陷阱**：  
> ```cpp
> int x = 0;
> if (false && (++x > 0)) {
>     // ...
> }
> std::cout << x; // 输出 0！++x 没执行
> ```
>  
> **记住**：**短路是安全机制，也是逻辑陷阱**——永远不要在条件中放有副作用的表达式，除非你明确依赖短路。

---

### 【第 5 步：程序执行路径可视化——画出你的“决策地图”】（00:50–01:00）

> 现在，拿出纸笔，跟我画一个简单程序的执行路径：

> 程序：
> ```cpp
> if (age >= 18) {
>     std::cout << "Adult\n";
> } else {
>     std::cout << "Minor\n";
> }
> ```

> **路径图**：
> ```
> 开始
>   │
>   ▼
> [age >= 18?] ——是——→ 输出 "Adult"
>   │
>   否
>   │
>   ▼
> 输出 "Minor"
>   │
>   ▼
> 结束
> ```
>  
> 这就是**控制流图**——未来所有复杂程序，都由这样的基本块组成。  
>  
> **今天的目标**：让你的大脑能自动“画出”这张图。

---

### 【第 6 步：动手实验——预测、验证、反思】（01:00–01:25）

> 现在，请你亲手验证：

> **【基础任务】布尔预测（15 分钟）**  
> 预测以下代码输出，再运行验证：
> ```cpp
> // 1
> int a = 5, b = 0;
> bool r1 = (a > 0) && (b != 0);
> std::cout << r1 << "\n"; // ?

> // 2
> int x = -1;
> bool r2 = (x < 0) || (x++ > 0);
> std::cout << r2 << ", x=" << x << "\n"; // ?
> ```

> **【进阶任务】短路安全实验（20 分钟）**  
> 1. 模拟安全检查：
>    ```cpp
>    bool is_ready = false;
>    int data = 100;
>    if (is_ready && data > 0) {
>        std::cout << "Processing...\n";
>    } else {
>        std::cout << "Not ready.\n";
>    }
>    ```
> 2. 制造副作用遗漏：
>    ```cpp
>    int counter = 0;
>    if (false && (++counter > 0)) {}
>    std::cout << "counter = " << counter << "\n"; // ?
>    ```

> **【陷阱任务】优先级陷阱（10 分钟）**  
> 预测：
> ```cpp
> bool r = true || false && false;
> std::cout << r << "\n"; // true 还是 false？
> ```
> 然后加括号强制 `||` 先算：`bool r = (true || false) && false;`，观察变化。

---

### 【第 7 步：总结 + 衔接下一阶段】（01:25–01:30）

> 今天我们完成了控制流的“大脑训练”：  
>  
> ✅ 理解了顺序执行的局限；  
> ✅ 掌握了短路求值的安全价值与陷阱；  
> ✅ 能预测复杂布尔表达式的结果；  
> ✅ 学会了画程序执行路径图。  
>  
> 但光有“决策语言”还不够——你需要**语法结构来表达决策**。  
>  
> 下一阶段（01:30–03:00），我们将学习 **`if-else` 语句**：  
> - 如何用花括号包裹分支；  
> - 如何避免“悬空 else”；  
> - 如何用多级 `else if` 实现成绩评级。  
>  
> 而你今天深化的布尔逻辑，将成为 `if` 条件的坚实基础。  
>  
> 准备好写你的第一个分支程序了吗？我们继续。

---

> 📌 **教学原则达成检查**：  
> - ✅ 结构先行：以“问题 → 逻辑 → 可视化 → 实验”为认知链；  
> - ✅ 生活化比喻：“直行列车 vs 自动驾驶汽车”贯穿控制流价值；  
> - ✅ 动手为王：三层练习（预测/安全/陷阱），含副作用与优先级实验；  
> - ✅ 防错前置：强调短路副作用、优先级混淆等经典陷阱；  
> - ✅ 衔接清晰：为01:30–03:00的 `if-else` 教学提供布尔表达式能力支撑。
