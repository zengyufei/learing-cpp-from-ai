### 第 1 周第 2 天 12:00–13:30 阶段详细教学内容大纲  
**阶段标题：控制流代码风格与可读性规范——从“能跑”到“可维护”的控制逻辑**

---

#### **本阶段学习目标**  
1. 理解控制流代码（`if` / `while` / `for`）的可读性对调试与协作的关键价值；  
2. 掌握 C++ 社区主流风格规范（以 Google C++ Style Guide 为基础）在控制流中的具体应用；  
3. 能对包含复杂条件、嵌套循环、`break` / `continue` 的代码进行命名、缩进、空行、注释等方面的规范化重构；  
4. 区分“语法正确”与“风格良好”的差异，建立专业控制流编码意识；  
5. 初步形成“逻辑清晰优先于代码简短”的工程哲学。

---

#### **本阶段知识点分解**

##### 1. **为什么控制流代码更需要风格规范？**
- **现实痛点**：  
  - 嵌套 `if` / `for` 易导致“金字塔代码”（右移过深）；  
  - 复杂条件表达式难以理解（如 `if (a && b || c && !d)`）；  
  - `break` / `continue` 滥用导致控制流跳跃，难以追踪。
- **生活化比喻**：  
  > “无风格的控制流代码像迷宫——你能进去，但不一定出得来；  
  > 有风格的代码像地铁图——每条路径清晰标注，换乘点一目了然。”

##### 2. **核心风格规范在控制流中的应用**
- **缩进与空行**：  
  - 每层控制结构缩进 2 空格；  
  - 循环/条件块之间用空行分隔逻辑段；  
  - 避免超过 3 层嵌套（超深嵌套应提取函数，第 3 周实践）。
- **条件表达式可读性**：  
  - **拆分复杂条件**为布尔变量：
    ```cpp
    bool is_valid_age = (age >= 0 && age <= 150);
    bool is_adult = (age >= 18);
    if (is_valid_age && is_adult) { ... }
    ```
  - **括号显式分组**：`if ((a && b) || (c && d))` 而非 `if (a && b || c && d)`。
- **循环结构清晰化**：  
  - `for` 循环三要素尽量简单（避免在条件中调用函数）；  
  - `while` 循环条件应为单一布尔表达式或清晰函数调用。
- **`break` / `continue` 使用原则**：  
  - 仅用于简化逻辑，**避免替代 `if-else`**；  
  - 在 `continue` 前加注释说明跳过原因；
  - 禁止在大型循环体中部使用（易丢失上下文）。

##### 3. **常见风格反模式（Anti-Patterns）**
- ❌ **右移深渊**：4 层以上嵌套 `if` / `for`；  
- ❌ **一行多条件**：`if (x>0 && y<10 || z==0 && w!=5)`；  
- ❌ **无注释的 `continue`**：读者无法理解为何跳过；  
- ❌ **`for` 循环体过长**（>20 行），应提取函数；  
- ❌ **`while (true)` 无明确 `break` 条件**，导致退出点分散。

##### 4. **重构实践：从“能跑”到“好看”**
- **重构四步法**：  
  1. **保留功能**：确保行为不变；  
  2. **拆分条件**：复杂布尔表达式 → 命名布尔变量；  
  3. **格式化布局**：缩进、空行、空格；  
  4. **添加必要注释**：解释非显而易见的 `break` / `continue`。
- **工具辅助意识**：  
  - 介绍 `clang-format`（不实操，仅说明“有自动格式化工具”）；  
  - 强调：**工具是辅助，理解规范才是根本**。

---

#### **本阶段动手练习任务**

- **【基础任务】风格诊断（30 分钟）**  
  提供一段风格混乱但功能正确的控制流代码（如无缩进、复杂条件、无注释的 `continue`），要求学生：  
  1. 指出至少 5 处风格问题；  
  2. 说明每处问题为何影响可读性或可维护性。

- **【进阶任务】重构菜单系统（40 分钟）**  
  基于 10:30–12:00 阶段编写的交互式菜单系统，进行风格升级：  
  1. 拆分复杂条件（如选项验证）为布尔变量；  
  2. 确保 `while (true)` 循环中 `break` 条件清晰；  
  3. 为 `continue` 添加注释（如“// 跳过无效输入，重试”）；  
  4. 使用 2 空格缩进，逻辑块间加空行；  
  5. 确保无超过 3 层嵌套。

- **【陷阱任务】可读性陷阱（20 分钟）**  
  提供一段“过度优化”的代码：
  ```cpp
  for (int i=0; i<n; i++) if (a[i]>0) for (int j=0; j<m; j++) if (b[j]<0) { ... }
  ```
  要求：  
  1. 重写为可读形式；  
  2. 讨论：代码简短 vs 逻辑清晰，哪个更重要？

---

#### **跨阶段综合小测/项目**  
- 本阶段重构后的菜单系统，将作为 **第 5 天“简易计算器”项目** 的代码风格模板；  
- 项目评审将包含 **控制流可读性评分项**（条件拆分、嵌套深度、`break` / `continue` 注释）；  
- 若提交代码风格混乱，即使功能正确，也将要求返工。

---

#### **与前后阶段的知识衔接说明**

- **前置依赖**：10:30–12:00 阶段已产出原始菜单系统代码，本阶段对其进行**美学与工程化升级**；  
- **后继支撑**：  
  - 13:30–15:00 的“错误分类”将强调“风格问题虽不导致编译失败，但会引发逻辑错误”；  
  - 第 3 周“函数封装”将要求将深层嵌套逻辑提取为函数，回溯本阶段“避免右移深渊”原则；  
- **螺旋上升点**：  
  - 第 11 周“综合项目”将采用团队代码审查（Code Review），风格规范是基本门槛；  
  - 第 19 周“设计模式”将强调“清晰控制流是策略模式、状态模式可读性的基石”。

--- 

> 本阶段标志着学生从“控制流实现者”向“控制流设计师”的初步转变。代码不仅是给机器执行的指令，更是给人阅读的文档。风格不是“花架子”，而是降低认知负荷、预防缺陷、提升协作效率的核心工程实践。必须通过亲手重构，将规范内化为本能。