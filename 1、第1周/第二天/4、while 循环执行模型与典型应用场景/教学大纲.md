## **while 循环执行模型与典型应用场景**

---

#### **本阶段学习目标**  
1. 掌握 `while` 循环的基本语法、执行流程与循环不变式概念；  
2. 能区分 `while` 与 `if` 的本质差异：**重复执行 vs 单次判断**；  
3. 理解循环三要素：**初始化、条件判断、更新操作**，并能正确设置避免无限循环；  
4. 能应用 `while` 实现典型场景：未知次数输入、菜单重试、数值逼近、简单游戏逻辑；  
5. 初步建立循环调试策略：插入计数器、打印变量、设置最大迭代次数。

---

#### **本阶段知识点分解**

##### 1. **while 循环语法与执行模型**
- **基本语法**：
  ```cpp
  while (condition) {
      // 循环体
  }
  ```
- **执行流程**：  
  1. 计算 `condition`；  
  2. 若为 `true`，执行循环体，然后**回到步骤 1**；  
  3. 若为 `false`，**跳出循环**，执行后续代码。  
- **关键特征**：**先判断，后执行**（可能一次都不执行）。

##### 2. **循环三要素与无限循环预防**
- **三要素**：  
  - **初始化**：设置循环变量初值（如 `int count = 0;`）；  
  - **条件**：控制循环继续的布尔表达式（如 `count < 10`）；  
  - **更新**：在循环体内修改循环变量（如 `count++`）。  
- **无限循环陷阱**：  
  - ❌ 条件永不为假（如 `while (true)` 无 `break`）；  
  - ❌ 循环体内未更新条件变量（如忘记 `count++`）；  
  - ❌ 更新方向错误（如 `count--` 但条件为 `count < 10`）。  
- **防御策略**：  
  - 插入调试输出：`std::cout << "count=" << count << "\n";`；  
  - 设置最大迭代次数：`int max_iter = 1000; while (cond && iter++ < max_iter) ...`

##### 3. **典型应用场景**
- **场景 1：未知次数输入重试**  
  ```cpp
  int choice;
  while (true) {
      std::cout << "Enter 1 or 2: ";
      std::cin >> choice;
      if (choice == 1 || choice == 2) break;
      std::cout << "Invalid! Try again.\n";
  }
  ```
- **场景 2：读取直到特定值**  
  ```cpp
  double x;
  while (std::cin >> x && x != -1) {
      // 处理 x，-1 为终止信号
  }
  ```
- **场景 3：数值逼近（如猜数字）**  
  ```cpp
  int guess;
  while (guess != answer) {
      std::cin >> guess;
      if (guess < answer) std::cout << "Too small\n";
      else if (guess > answer) std::cout << "Too big\n";
  }
  ```

##### 4. **while 与 if 的本质对比**
| 特性         | `if`                     | `while`                     |
|--------------|--------------------------|-----------------------------|
| 执行次数     | 最多 1 次                  | 0 次或多次                   |
| 目的         | 分支选择                 | 重复执行                    |
| 条件变化     | 通常不变                 | 循环体内必须更新            |
| 典型错误     | 悬空 else                | 无限循环                    |
| **生活化比喻** | **路口红绿灯**（停或行） | **跑步机**（持续跑直到按停）|

##### 5. **调试与健壮性技巧**
- **插入计数器**：防止逻辑错误导致超长循环；  
- **打印关键变量**：观察循环变量变化是否符合预期；  
- **输入流状态检查**：结合 `cin.fail()` 避免无效输入导致死循环；  
- **明确退出条件**：每个 `while` 必须有清晰的终止路径。

---

#### **本阶段动手练习任务**

- **【基础任务】循环基础训练（30 分钟）**  
  1. 编写程序：用 `while` 输出 1 到 10；  
  2. 编写程序：计算 1 到 100 的和；  
  3. 故意制造无限循环（如省略 `i++`），观察现象并修复。

- **【进阶任务】输入重试机制（40 分钟）**  
  1. 改造单位转换器：  
     - 选项输错（非 1/2）时，**循环提示重输**；  
     - 数值输入失败时，**清空错误状态并重试**（使用 `std::cin.clear()` 和 `std::cin.ignore(1000, '\n')`，提供模板）；  
  2. 实现通用整数输入函数（雏形）：
     ```cpp
     int getValidChoice() {
         int c;
         while (true) {
             std::cin >> c;
             if (c == 1 || c == 2) return c;
             std::cout << "Invalid, try again: ";
             std::cin.clear();
             std::cin.ignore(1000, '\n');
         }
     }
     ```

- **【陷阱任务】无限循环诊断（20 分钟）**  
  1. 分析以下代码为何无限循环：
     ```cpp
     int i = 10;
     while (i > 0) {
         std::cout << i << "\n";
         i--; // 若注释此行？
     }
     ```
  2. 修复“猜数字”游戏中的潜在死循环（如用户一直输非数字）。

---

#### **跨阶段综合小测/项目**  
- 本阶段 `while` 能力将直接用于 **15:00–16:30 的猜数字游戏**：  
  - 实现主循环、输入重试、猜测计数；  
- 同时支撑 **19:30–21:00 的数学练习器** 中的题数控制与单题重试。

---

#### **与前后阶段的知识衔接说明**

- **前置依赖**：03:30–04:30 阶段已建立输入验证需求，本阶段提供**循环重试解决方案**；  
- **后继支撑**：  
  - 06:00–07:30 的 `for` 循环将对比 `while`，展示计数器模式的简洁写法；  
  - 07:30–09:00 的编码训练将包含斐波那契数列（`while` 生成）；  
- **螺旋上升点**：  
  - 第 3 周“函数封装”将把 `getValidChoice()` 提取为独立函数；  
  - 第 5 周“文件 I/O”将用 `while (file >> x)` 读取未知行数文件。

--- 

> 本阶段是程序从“单次响应”迈向“持续交互”的关键跃迁。必须通过亲手制造、诊断、修复无限循环，建立对循环三要素的肌肉记忆。`while` 不是魔法，而是精确控制重复的工程工具——每一次迭代，都必须有明确的起点、条件和终点。