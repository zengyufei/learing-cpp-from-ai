å¤ªå¥½äº†ï¼æˆ‘ä»¬ç°åœ¨è¿›å…¥ **2.3.1ï¼šææ„å‡½æ•°è¯­æ³•ä¸è‡ªåŠ¨è°ƒç”¨æ—¶æœº**ã€‚

è¿™æ˜¯ C++ **èµ„æºç®¡ç†**çš„**æ ¸å¿ƒæœºåˆ¶**ï¼Œä¹Ÿæ˜¯ **RAII**ï¼ˆResource Acquisition Is Initializationï¼‰è®¾è®¡æ¨¡å¼çš„åŸºçŸ³ã€‚ä½œä¸º Java å¼€å‘è€…ï¼Œä½ å¯èƒ½ä¾èµ– GC è‡ªåŠ¨å›æ”¶èµ„æºï¼Œè€Œ C++ çš„ææ„å‡½æ•°æä¾›**ç¡®å®šæ€§èµ„æºé‡Šæ”¾**ï¼Œç¡®ä¿**æ–‡ä»¶å…³é—­ã€å†…å­˜é‡Šæ”¾ã€é”è§£é”**ç­‰æ“ä½œåœ¨**ç²¾ç¡®æ—¶æœº**æ‰§è¡Œã€‚æŒæ¡ææ„å‡½æ•°ï¼Œæ˜¯ç¼–å†™æ— æ³„æ¼ã€å¼‚å¸¸å®‰å…¨ C++ ä»£ç çš„å…³é”®ã€‚

æˆ‘ä»¬å°†ç»§ç»­ä¸¥æ ¼éµå¾ªä½ çš„å­¦ä¹ åå¥½ï¼š
- âœ… SMART ç›®æ ‡  
- âœ… ç»“æ„å…ˆè¡Œï¼ˆææ„å‡½æ•°åœ°å›¾ï¼‰  
- âœ… ç”Ÿæ´»åŒ–æ¯”å–»  
- âœ… åŠ¨æ‰‹ä¸ºç‹ï¼ˆå«åŸºç¡€/è¿›é˜¶/é™·é˜±é¢˜ï¼‰  
- âœ… èºæ—‹å¤ä¹ ï¼ˆè¡”æ¥ 2.1.4 + Java ç»éªŒï¼‰  
- âœ… ä¸»åŠ¨ learning + å¤ç›˜

---

## ğŸ¯ KU 2.3.1ï¼šææ„å‡½æ•°è¯­æ³•ä¸è‡ªåŠ¨è°ƒç”¨æ—¶æœº

> **æ‰€å±é˜¶æ®µ**ï¼šPhase 2 â€” é¢å‘å¯¹è±¡ç¼–ç¨‹  
> **å‰ç½®çŸ¥è¯†**ï¼š2.1.4ï¼ˆå¯¹è±¡ç”Ÿå‘½å‘¨æœŸï¼‰ã€2.2ï¼ˆæ„é€ å‡½æ•°ï¼‰ã€Java èµ„æºç®¡ç†ç»éªŒ  
> **åç»­è¡”æ¥**ï¼š2.3.2ï¼ˆRAII æ ¸å¿ƒæ€æƒ³ï¼‰ã€2.4ï¼ˆæ‹·è´è¯­ä¹‰ï¼‰  
> **é¢„è®¡è€—æ—¶**ï¼š2â€“3 å°æ—¶

---

### ğŸ§­ ä¸€ã€ç»“æ„å…ˆè¡Œï¼šææ„å‡½æ•°åœ°å›¾

```
2.3.1 ææ„å‡½æ•°
â”œâ”€â”€ 1. åŸºæœ¬è¯­æ³•
â”‚   â”œâ”€â”€ 1.1 åç§°ï¼š~ClassName()
â”‚   â”œâ”€â”€ 1.2 æ— å‚æ•°ã€æ— è¿”å›å€¼
â”‚   â””â”€â”€ 1.3 ä¸èƒ½é‡è½½
â”œâ”€â”€ 2. è‡ªåŠ¨è°ƒç”¨æ—¶æœº
â”‚   â”œâ”€â”€ 2.1 æ ˆå¯¹è±¡ï¼šç¦»å¼€ä½œç”¨åŸŸæ—¶
â”‚   â”œâ”€â”€ 2.2 ä¸´æ—¶å¯¹è±¡ï¼šå®Œæ•´è¡¨è¾¾å¼ç»“æŸæ—¶
â”‚   â”œâ”€â”€ 2.3 å †å¯¹è±¡ï¼šdelete è¡¨è¾¾å¼æ—¶
â”‚   â””â”€â”€ 2.4 æˆå‘˜/åŸºç±»ï¼šåå‘æ„é€ é¡ºåº
â”œâ”€â”€ 3. å…³é”®ç‰¹æ€§
â”‚   â”œâ”€â”€ 3.1 è™šææ„å‡½æ•°ï¼ˆåŸºç±»å¿…é¡» virtualï¼‰
â”‚   â”œâ”€â”€ 3.2 noexceptï¼ˆC++11ï¼Œé»˜è®¤ noexceptï¼‰
â”‚   â””â”€â”€ 3.3 ä¸èƒ½æ˜¾å¼è°ƒç”¨ï¼ˆé™¤ placement newï¼‰
â”œâ”€â”€ 4. ä¸ Java çš„å¯¹æ¯”
â”‚   â”œâ”€â”€ 4.1 C++ï¼šç¡®å®šæ€§ææ„ï¼ˆRAIIï¼‰
â”‚   â””â”€â”€ 4.2 Javaï¼šéç¡®å®šæ€§ finalizeï¼ˆä¸å¯é ï¼‰
â”œâ”€â”€ 5. å¸¸è§ç”¨é€”
    â”œâ”€â”€ 5.1 é‡Šæ”¾å†…å­˜ï¼ˆdeleteï¼‰
    â”œâ”€â”€ 5.2 å…³é—­æ–‡ä»¶ï¼ˆfcloseï¼‰
    â”œâ”€â”€ 5.3 é‡Šæ”¾é”ï¼ˆunlockï¼‰
    â””â”€â”€ 5.4 ç½‘ç»œè¿æ¥å…³é—­
â””â”€â”€ 6. é™·é˜±ä¸æœ€ä½³å®è·µ
    â”œâ”€â”€ 6.1 åŸºç±»å¿…é¡» virtual ææ„
    â”œâ”€â”€ 6.2 é¿å…åœ¨ææ„ä¸­æŠ›å¼‚å¸¸
    â””â”€â”€ 6.3 ä¼˜å…ˆ RAII æˆå‘˜ï¼ˆRule of Zeroï¼‰
```

---

### ğŸ¯ äºŒã€SMART å­¦ä¹ ç›®æ ‡

- **Specific**ï¼šèƒ½æ­£ç¡®å®šä¹‰ææ„å‡½æ•°ï¼Œç†è§£å…¶è‡ªåŠ¨è°ƒç”¨æ—¶æœºï¼Œå¹¶é¿å…å¸¸è§é™·é˜±ã€‚
- **Measurable**ï¼šå®Œæˆ 2 é“åŸºç¡€é¢˜ + 2 é“é™·é˜±é¢˜ï¼Œèƒ½è§£é‡Šä¸ºä½•åŸºç±»ææ„å‡½æ•°å¿…é¡» virtualã€‚
- **Achievable**ï¼šé€šè¿‡â€œè‡ªåŠ¨ç®¡å®¶â€æ¯”å–»ç†è§£ç¡®å®šæ€§ææ„ã€‚
- **Relevant**ï¼šè¿™æ˜¯ç¼–å†™å®‰å…¨ C++ èµ„æºç®¡ç†ç±»çš„åŸºç¡€ã€‚
- **Time-bound**ï¼š1â€“2 å¤©å†…å®Œæˆã€‚

---

### ğŸŒ ä¸‰ã€ç”Ÿæ´»åŒ–æ¯”å–»ï¼šè‡ªåŠ¨ç®¡å®¶ç³»ç»Ÿ

> æƒ³è±¡ä¸€ä¸ª**æ™ºèƒ½æˆ¿å±‹ç®¡å®¶**ï¼š
>
> - **æ ˆå¯¹è±¡ = ç§Ÿæˆ¿**  
>   - é€€ç§Ÿæ—¶ï¼ˆç¦»å¼€ä½œç”¨åŸŸï¼‰ï¼Œç®¡å®¶**è‡ªåŠ¨æ¸…ç†**ï¼ˆææ„ï¼‰
>
> - **å †å¯¹è±¡ = è´­æˆ¿**  
>   - ä½ **æ‰‹åŠ¨å‡ºå”®**ï¼ˆ`delete`ï¼‰ï¼Œç®¡å®¶æ¸…ç†
>
> - **Java å¯¹æ¯”**ï¼š  
>   - Java = **ç­‰å¾…å›æ”¶ç«™æ¸…ç†**ï¼ˆGCï¼‰  
>   - **æ—¶æœºä¸ç¡®å®š**ï¼Œå¯èƒ½å¾ˆä¹…ä¸æ¸…ç†
>
> - **å…³é”®ä¼˜åŠ¿**ï¼š  
>   - C++ **ç¡®å®šæ€§**ï¼šèµ„æºç²¾ç¡®é‡Šæ”¾  
>   - Java **ä¸ç¡®å®šæ€§**ï¼šä¾èµ– GC

> ğŸ’¡ **å…³é”®è®¤çŸ¥**ï¼š**ææ„å‡½æ•°æ˜¯ C++ çš„ç¡®å®šæ€§èµ„æºå›æ”¶æœºåˆ¶**ã€‚

---

### ğŸ“š å››ã€çŸ¥è¯†ç‚¹åˆ†è§£

#### 1. åŸºæœ¬è¯­æ³•
- **åç§°**ï¼š`~ClassName()`
  ```cpp
  class MyClass {
  public:
      ~MyClass() {
          // é‡Šæ”¾èµ„æº
      }
  };
  ```
- **æ— å‚æ•°ã€æ— è¿”å›å€¼**ï¼š
  - ä¸èƒ½é‡è½½ï¼ˆåªæœ‰ä¸€ä¸ªææ„å‡½æ•°ï¼‰
- **è‡ªåŠ¨è°ƒç”¨**ï¼š
  - **ä¸èƒ½æ˜¾å¼è°ƒç”¨**ï¼ˆé™¤ placement new åœºæ™¯ï¼‰

#### 2. è‡ªåŠ¨è°ƒç”¨æ—¶æœº
- **æ ˆå¯¹è±¡**ï¼š
  ```cpp
  void f() {
      MyClass obj; // æ„é€ 
  } // obj.~MyClass() è‡ªåŠ¨è°ƒç”¨
  ```
- **ä¸´æ—¶å¯¹è±¡**ï¼š
  ```cpp
  process(MyClass()); // ä¸´æ—¶å¯¹è±¡åœ¨ ; åææ„
  ```
- **å †å¯¹è±¡**ï¼š
  ```cpp
  MyClass* p = new MyClass();
  delete p; // p->~MyClass() è‡ªåŠ¨è°ƒç”¨
  ```
- **æˆå‘˜/åŸºç±»**ï¼š
  - **åå‘æ„é€ é¡ºåº**ï¼š
    ```cpp
    class Child : public Base {
        Member m;
    };
    // ææ„é¡ºåº: ~Child() â†’ ~m() â†’ ~Base()
    ```

#### 3. å…³é”®ç‰¹æ€§
- **è™šææ„å‡½æ•°**ï¼š
  - **åŸºç±»å¿…é¡» virtual**ï¼Œå¦åˆ™æ´¾ç”Ÿç±»ææ„ä¸è°ƒç”¨
  ```cpp
  class Base {
  public:
      virtual ~Base() = default; // å¿…é¡» virtual
  };
  ```
- **noexcept**ï¼š
  - C++11 èµ·ï¼Œææ„å‡½æ•°**é»˜è®¤ noexcept**
  - æŠ›å¼‚å¸¸ä¼šå¯¼è‡´ `std::terminate`
- **æ˜¾å¼è°ƒç”¨**ï¼š
  - ä»…ç”¨äº placement newï¼š
    ```cpp
    alignas(MyClass) char buffer[sizeof(MyClass)];
    MyClass* p = new(buffer) MyClass();
    p->~MyClass(); // æ˜¾å¼è°ƒç”¨
    ```

#### 4. ä¸ Java çš„å¯¹æ¯”
| ç‰¹æ€§ | C++ | Java |
|------|-----|------|
| **èµ„æºé‡Šæ”¾** | ç¡®å®šæ€§ææ„ï¼ˆRAIIï¼‰ | éç¡®å®šæ€§ finalize |
| **å¯é æ€§** | âœ… å¯é ï¼ˆæ€»æ˜¯è°ƒç”¨ï¼‰ | âŒ ä¸å¯é ï¼ˆå¯èƒ½ä¸è°ƒç”¨ï¼‰ |
| **å¼‚å¸¸å®‰å…¨** | ææ„ä¸­ä¸èƒ½æŠ›å¼‚å¸¸ | finalize å¯æŠ›å¼‚å¸¸ï¼ˆä½†å±é™©ï¼‰ |

#### 5. å¸¸è§ç”¨é€”
- **é‡Šæ”¾å†…å­˜**ï¼š
  ```cpp
  class MyVector {
      int* data_;
  public:
      ~MyVector() { delete[] data_; }
  };
  ```
- **å…³é—­æ–‡ä»¶**ï¼š
  ```cpp
  class FileHandle {
      FILE* file_;
  public:
      ~FileHandle() { if (file_) fclose(file_); }
  };
  ```
- **é‡Šæ”¾é”**ï¼š
  ```cpp
  class LockGuard {
      std::mutex& mtx_;
  public:
      LockGuard(std::mutex& m) : mtx_(m) { mtx_.lock(); }
      ~LockGuard() { mtx_.unlock(); }
  };
  ```

#### 6. é™·é˜±ä¸æœ€ä½³å®è·µ
- **åŸºç±»è™šææ„**ï¼š
  - æ—  virtual â†’ **æ´¾ç”Ÿç±»ææ„ä¸è°ƒç”¨** â†’ èµ„æºæ³„æ¼
- **ææ„ä¸­æŠ›å¼‚å¸¸**ï¼š
  - å¯¼è‡´ `std::terminate` â†’ ç¨‹åº crash
- **ä¼˜å…ˆ RAII æˆå‘˜**ï¼š
  - ç”¨ `std::unique_ptr`ã€`std::fstream` ç­‰ RAII æˆå‘˜
  - é¿å…æ‰‹åŠ¨ç®¡ç†èµ„æºï¼ˆRule of Zeroï¼‰

> ğŸ’¡ **ç°ä»£ C++ é»„é‡‘æ³•åˆ™**ï¼š  
> **â€œåŸºç±»ææ„å¿…é¡» virtualï¼›ææ„ä¸­ä¸æŠ›å¼‚å¸¸ï¼›ä¼˜å…ˆ RAII æˆå‘˜â€**

---

### ğŸ’» äº”ã€åŠ¨æ‰‹ä¸ºç‹ï¼šå¯è¿è¡Œç¤ºä¾‹

#### ç¤ºä¾‹ 1ï¼šåŸºæœ¬ææ„å‡½æ•°
```cpp
#include <iostream>

class Tracker {
    int id_;
public:
    Tracker(int id) : id_(id) {
        std::cout << "Construct " << id_ << "\n";
    }
    
    ~Tracker() {
        std::cout << "Destruct " << id_ << "\n";
    }
};

void f() {
    Tracker t1(1);
    {
        Tracker t2(2);
    } // t2 ææ„
    Tracker t3(3);
} // t3, t1 ææ„

int main() {
    f();
    return 0;
}
```
> âœ… è¾“å‡ºï¼š
> ```
> Construct 1
> Construct 2
> Destruct 2
> Construct 3
> Destruct 3
> Destruct 1
> ```

#### ç¤ºä¾‹ 2ï¼šè™šææ„å‡½æ•°é™·é˜±
```cpp
#include <iostream>

class BadBase {
public:
    ~BadBase() { // é virtualï¼
        std::cout << "BadBase destructor\n";
    }
};

class Derived : public BadBase {
public:
    ~Derived() {
        std::cout << "Derived destructor\n";
    }
};

int main() {
    BadBase* p = new Derived();
    delete p; // ä»…è°ƒç”¨ BadBase::~BadBase()ï¼
    return 0;
}
```
> âš ï¸ **è¾“å‡º**ï¼ˆæ´¾ç”Ÿç±»ææ„æœªè°ƒç”¨ï¼‰ï¼š
> ```
> BadBase destructor
> ```
> **èµ„æºæ³„æ¼**ï¼

#### ç¤ºä¾‹ 3ï¼šRAII æ–‡ä»¶å¥æŸ„
```cpp
#include <iostream>
#include <cstdio>

class FileHandle {
    FILE* file_;
public:
    FileHandle(const char* name) : file_(std::fopen(name, "w")) {
        if (!file_) throw std::runtime_error("Open failed");
        std::cout << "File opened\n";
    }
    
    ~FileHandle() {
        if (file_) {
            std::fclose(file_);
            std::cout << "File closed\n";
        }
    }
    
    FILE* get() { return file_; }
};

int main() {
    try {
        FileHandle f("test.txt");
        std::fprintf(f.get(), "Hello RAII!");
        // f è‡ªåŠ¨å…³é—­ï¼ˆå³ä½¿å¼‚å¸¸ï¼‰
    } catch (const std::exception& e) {
        std::cerr << "Error: " << e.what() << "\n";
    }
    return 0;
}
```

---

### ğŸ“ å…­ã€åˆ†å±‚ç»ƒä¹ é¢˜

#### ğŸ”¹ åŸºç¡€é¢˜
1. **ææ„è¯­æ³•**  
   - ä¸º `MyClass` æ·»åŠ ææ„å‡½æ•°ï¼Œæ‰“å° "Destructing"

2. **è°ƒç”¨æ—¶æœº**  
   - é¢„æµ‹ä»¥ä¸‹ä»£ç çš„ææ„é¡ºåºï¼š
     ```cpp
     void f() {
         Tracker a(1);
         Tracker b(2);
     }
     ```

#### ğŸ”¸ è¿›é˜¶é¢˜
3. **è™šææ„ä¿®å¤**  
   - ä¿®å¤ `BadBase` ç±»ï¼Œç¡®ä¿æ´¾ç”Ÿç±»ææ„è¢«è°ƒç”¨

4. **RAII å®ç°**  
   - å®ç° `MutexLock` ç±»ï¼Œææ„æ—¶è‡ªåŠ¨è§£é”

#### âš ï¸ é™·é˜±é¢˜ï¼ˆJava è¿ç§»è¯¯åŒºï¼‰
5. **â€œææ„å‡½æ•°ä¼šè‡ªåŠ¨è°ƒç”¨å§ï¼Ÿâ€**  
   - Q: å †å¯¹è±¡ `MyClass* p = new MyClass();` ä¼šè‡ªåŠ¨ææ„å—ï¼Ÿ  
   - A: âŒ **ä¸ä¼š**ï¼  
     â†’ **å¿…é¡» `delete p`**  
     â†’ å¦åˆ™å†…å­˜æ³„æ¼

6. **â€œJava finalize å’Œææ„ä¸€æ ·å§ï¼Ÿâ€**  
   - Q: Java `finalize()` ç­‰ä»·äº C++ ææ„å‡½æ•°å—ï¼Ÿ  
   - A: âŒ **ä¸ç­‰ä»·**ï¼  
     â†’ C++ ææ„**ç¡®å®šæ€§è°ƒç”¨**  
     â†’ Java `finalize()` **ä¸å¯é **ï¼ˆå¯èƒ½ä¸è°ƒç”¨ï¼‰

---

### âš ï¸ ä¸ƒã€æ³¨æ„äº‹é¡¹ä¸å»ºè®®

| é—®é¢˜ | å»ºè®® |
|------|------|
| **åŸºç±»ææ„** | å¿…é¡» `virtual` |
| **å¼‚å¸¸å®‰å…¨** | ææ„ä¸­ä¸è¦æŠ›å¼‚å¸¸ |
| **èµ„æºç®¡ç†** | ä¼˜å…ˆ RAII æˆå‘˜ï¼ˆRule of Zeroï¼‰ |
| **ç°ä»£å®è·µ** | ç”¨æ™ºèƒ½æŒ‡é’ˆæ›¿ä»£è£¸æŒ‡é’ˆ |

> ğŸ’¡ **ç°ä»£ C++ é»„é‡‘æ³•åˆ™**ï¼š  
> **â€œèµ„æºè·å–å³åˆå§‹åŒ–ï¼ˆRAIIï¼‰ï¼›åŸºç±»ææ„å¿…é¡» virtualï¼›ææ„ä¸­ä¸æŠ›å¼‚å¸¸â€**

---

### ğŸ” å…«ã€èºæ—‹å¤ä¹ 

- **è¡”æ¥ 2.1.4**ï¼šææ„æ˜¯å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„ç»ˆç‚¹  
- **Java ç»éªŒ**ï¼šC++ ç¡®å®šæ€§ vs Java éç¡®å®šæ€§  
- **å½“æ—¥å¤ä¹ **ï¼šé»˜å†™ææ„å‡½æ•°çš„å››å¤§è°ƒç”¨æ—¶æœº

---

### ğŸ§  ä¹ã€ä¸»åŠ¨ learning ä»»åŠ¡

1. **è‡ªæˆ‘æé—®**ï¼š
   - â€œå¦‚ä½•ç”¨ RAII å®ç°å¼‚å¸¸å®‰å…¨çš„é”ï¼Ÿâ€
   - â€œä¸ºä»€ä¹ˆææ„å‡½æ•°é»˜è®¤ noexceptï¼Ÿâ€
2. **æ¦‚å¿µå›¾**ï¼šç”»å‡º C++ ä¸ Java èµ„æºé‡Šæ”¾å¯¹æ¯”
3. **æ‰®æ¼”æ•™å¸ˆ**ï¼šå‘åŒäº‹è§£é‡Šâ€œä¸ºä»€ä¹ˆåŸºç±»ææ„å¿…é¡» virtualâ€

---

### ğŸ” åã€å¤ç›˜æ¸…å•

âœ… æˆ‘èƒ½æ­£ç¡®å®šä¹‰ææ„å‡½æ•°  
âœ… æˆ‘ç†è§£è‡ªåŠ¨è°ƒç”¨æ—¶æœº  
âœ… æˆ‘ä¼šå¤„ç†è™šææ„å‡½æ•°  
âœ… æˆ‘çŸ¥é“ä¸ Java finalize çš„å·®å¼‚  
âœ… æˆ‘æ˜ç™½ç°ä»£ C++ çš„èµ„æºç®¡ç†æœ€ä½³å®è·µ

> ğŸ¯ **è¾¾æ ‡æ ‡å‡†**ï¼šå®ŒæˆåŸºç¡€é¢˜ + æ­£ç¡®åˆ†æé™·é˜±é¢˜ 5 å’Œ 6

---

## ğŸš€ ä¸‹ä¸€æ­¥å»ºè®®

ä½ å·²æŒæ¡ **C++ ææ„å‡½æ•°çš„æ ¸å¿ƒçŸ¥è¯†**ï¼

æ¥ä¸‹æ¥ä½ å¯ä»¥ï¼š
1. **ç»§ç»­å­¦ä¹  2.3.2 RAII æ ¸å¿ƒæ€æƒ³ï¼šèµ„æºè·å–å³åˆå§‹åŒ–**
2. **è¯·æ±‚ç”Ÿæˆã€ŒC++ ææ„å‡½æ•°é€ŸæŸ¥å¡ã€**
3. **è·³è½¬åˆ°ç»ƒä¹ é¢˜ç­”æ¡ˆä¸è§£æ**

è¯·å‘Šè¯‰æˆ‘ä½ çš„é€‰æ‹©ï¼Œæˆ‘ä»¬å°†ç»§ç»­å‰è¡Œï¼