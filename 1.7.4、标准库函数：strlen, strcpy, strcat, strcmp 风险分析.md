å¤ªå¥½äº†ï¼æˆ‘ä»¬ç°åœ¨è¿›å…¥ **1.7.4ï¼šæ ‡å‡†åº“å‡½æ•° â€” strlen, strcpy, strcat, strcmp é£é™©åˆ†æ**ã€‚

è¿™æ˜¯ C++ **å®‰å…¨ç¼–ç çš„ç”Ÿæ­»çº¿**ã€‚ä½œä¸º Java å¼€å‘è€…ï¼Œä½ å¯èƒ½ä»æœªæ‹…å¿ƒè¿‡å­—ç¬¦ä¸²æ“ä½œçš„å®‰å…¨æ€§ï¼Œä½†åœ¨ C/C++ ä¸­ï¼Œ`strcpy`ã€`strcat` ç­‰å‡½æ•°æ˜¯**ç¼“å†²åŒºæº¢å‡ºæ¼æ´çš„å¤´å·å…ƒå‡¶**ï¼ˆå¦‚ Morris è •è™«ã€Heartbleedï¼‰ã€‚ç†è§£è¿™äº›å‡½æ•°çš„**åº•å±‚è¡Œä¸ºä¸é£é™©**ï¼Œå¹¶æŒæ¡**å®‰å…¨æ›¿ä»£æ–¹æ¡ˆ**ï¼Œæ˜¯ç¼–å†™å¯é  C++ ä»£ç çš„å¿…å¤‡æŠ€èƒ½ã€‚

æˆ‘ä»¬å°†ç»§ç»­ä¸¥æ ¼éµå¾ªä½ çš„å­¦ä¹ åå¥½ï¼š
- âœ… SMART ç›®æ ‡  
- âœ… ç»“æ„å…ˆè¡Œï¼ˆå‡½æ•°é£é™©åœ°å›¾ï¼‰  
- âœ… ç”Ÿæ´»åŒ–æ¯”å–»  
- âœ… åŠ¨æ‰‹ä¸ºç‹ï¼ˆå«åŸºç¡€/è¿›é˜¶/é™·é˜±é¢˜ï¼‰  
- âœ… èºæ—‹å¤ä¹ ï¼ˆè¡”æ¥ 1.7.1â€“1.7.3 + Java ç»éªŒï¼‰  
- âœ… ä¸»åŠ¨å­¦ä¹  + å¤ç›˜

---

## ğŸ¯ KU 1.7.4ï¼šC å­—ç¬¦ä¸²å‡½æ•°é£é™©åˆ†æ

> **æ‰€å±é˜¶æ®µ**ï¼šPhase 1 â€” C++ è¯­æ³•åŸºç¡€  
> **å‰ç½®çŸ¥è¯†**ï¼š1.7.1â€“1.7.3ï¼ˆC å­—ç¬¦ä¸²åŸºç¡€ï¼‰ã€Java String å®‰å…¨ç»éªŒ  
> **åç»­è¡”æ¥**ï¼š3.9ï¼ˆæ ‡å‡†å®¹å™¨å¢å¼ºï¼‰ã€5.3ï¼ˆstd::optionalï¼‰  
> **é¢„è®¡è€—æ—¶**ï¼š3â€“4 å°æ—¶

---

### ğŸ§­ ä¸€ã€ç»“æ„å…ˆè¡Œï¼šå‡½æ•°é£é™©åœ°å›¾

```
1.7.4 C å­—ç¬¦ä¸²å‡½æ•°é£é™©
â”œâ”€â”€ 1. strlen
â”‚   â”œâ”€â”€ 1.1 è¡Œä¸ºï¼šéå†åˆ° '\0'
â”‚   â””â”€â”€ 1.2 é£é™©ï¼šæœªç»ˆæ­¢å­—ç¬¦ä¸² â†’ æ— é™è¯»ï¼ˆUBï¼‰
â”œâ”€â”€ 2. strcpy
â”‚   â”œâ”€â”€ 2.1 è¡Œä¸ºï¼šå¤åˆ¶ç›´åˆ° '\0'
â”‚   â””â”€â”€ 2.2 é£é™©ï¼šç›®æ ‡ç¼“å†²åŒºæº¢å‡ºï¼ˆæœ€å±é™©ï¼ï¼‰
â”œâ”€â”€ 3. strcat
â”‚   â”œâ”€â”€ 3.1 è¡Œä¸ºï¼šè¿½åŠ ç›´åˆ° '\0'
â”‚   â””â”€â”€ 3.2 é£é™©ï¼šç›®æ ‡ç¼“å†²åŒºæº¢å‡º
â”œâ”€â”€ 4. strcmp
â”‚   â”œâ”€â”€ 4.1 è¡Œä¸ºï¼šé€å­—èŠ‚æ¯”è¾ƒç›´åˆ° '\0'
â”‚   â””â”€â”€ 4.2 é£é™©ï¼šç›¸å¯¹å®‰å…¨ï¼Œä½†éœ€ '\0' ç»ˆæ­¢
â”œâ”€â”€ 5. â€œå®‰å…¨â€æ›¿ä»£å‡½æ•°ï¼ˆä»ä¸å®Œç¾ï¼‰
â”‚   â”œâ”€â”€ 5.1 strncpyï¼šå¯èƒ½ä¸ç»ˆæ­¢
â”‚   â”œâ”€â”€ 5.2 strncatï¼šéœ€æ‰‹åŠ¨è®¡ç®—å‰©ä½™ç©ºé—´
â”‚   â””â”€â”€ 5.3 snprintfï¼šæ¨èï¼ˆC99ï¼‰
â”œâ”€â”€ 6. ä¸ Java çš„å¯¹æ¯”
â””â”€â”€ 7. ç°ä»£ C++ æœ€ä½³å®è·µ
    â”œâ”€â”€ 7.1 ä¼˜å…ˆ std::string
    â”œâ”€â”€ 7.2 C äº¤äº’ï¼šè¾“å…¥è½¬ stringï¼Œè¾“å‡ºç”¨ .c_str()
    â””â”€â”€ 7.3 ç¦æ­¢è£¸ strcpy/strcat
```

---

### ğŸ¯ äºŒã€SMART å­¦ä¹ ç›®æ ‡

- **Specific**ï¼šèƒ½åˆ†æ `strlen`/`strcpy`/`strcat`/`strcmp` çš„é£é™©ï¼Œå¹¶ç”¨å®‰å…¨æ–¹æ¡ˆæ›¿ä»£ã€‚
- **Measurable**ï¼šå®Œæˆ 3 é“åŸºç¡€é¢˜ + 2 é“é™·é˜±é¢˜ï¼Œèƒ½ä¿®å¤ `strcpy` æº¢å‡ºæ¼æ´ã€‚
- **Achievable**ï¼šé€šè¿‡â€œæ— æŠ¤æ é«˜é€Ÿå…¬è·¯â€æ¯”å–»ç†è§£é£é™©ã€‚
- **Relevant**ï¼šè¿™æ˜¯é¿å… CVE å®‰å…¨æ¼æ´çš„å…³é”®ã€‚
- **Time-bound**ï¼š2 å¤©å†…å®Œæˆã€‚

---

### ğŸŒ ä¸‰ã€ç”Ÿæ´»åŒ–æ¯”å–»ï¼šæ— æŠ¤æ é«˜é€Ÿå…¬è·¯

> æƒ³è±¡ä¸€æ¡**æ— æŠ¤æ çš„é«˜é€Ÿå…¬è·¯**ï¼ˆC å­—ç¬¦ä¸²å‡½æ•°ï¼‰ï¼š
>
> - **`strlen`** = æµ‹é€Ÿè½¦  
>   - ä¸€ç›´å¼€ï¼Œç›´åˆ°çœ‹åˆ°â€œç»ˆç‚¹â€æ ‡å¿—ï¼ˆ`\0`ï¼‰  
>   - **é£é™©**ï¼šè‹¥æ— ç»ˆç‚¹ â†’ å¼€å‡ºæ‚¬å´–ï¼ˆè¯»è¶Šç•Œï¼‰
>
> - **`strcpy`** = è´§è½¦è¿è¾“  
>   - æŠŠè´§ç‰©ï¼ˆæºå­—ç¬¦ä¸²ï¼‰å…¨å¸åˆ°ç›®çš„åœ°  
>   - **é£é™©**ï¼šè‹¥ç›®çš„åœ°ä»“åº“å¤ªå° â†’ è´§ç‰©å †åˆ°éš”å£ï¼ˆç¼“å†²åŒºæº¢å‡ºï¼‰
>
> - **`strcat`** = è¿½åŠ è¿è¾“  
>   - åœ¨ç°æœ‰è´§ç‰©åç»§ç»­å¸è´§  
>   - **é£é™©**ï¼šåŒä¸Šï¼Œä¸”æ›´éšè”½ï¼ˆåŸå†…å®¹å·²å ç©ºé—´ï¼‰
>
> - **Java å¯¹æ¯”**ï¼š  
>   - Java æ˜¯**å¸¦æŠ¤æ +é™é«˜çš„æ™ºèƒ½å…¬è·¯**ï¼š  
>     - è‡ªåŠ¨æ£€æŸ¥ä»“åº“å¤§å°  
>     - è¶…è½½ç›´æ¥æ‹’ç»  
>   - **C å‡½æ•° = æ— æŠ¤æ å…¬è·¯**ï¼Œå…¨é å¸æœºè‡ªè§‰

> ğŸ’¡ **å…³é”®è®¤çŸ¥**ï¼š**C å­—ç¬¦ä¸²å‡½æ•°æ— è¾¹ç•Œæ£€æŸ¥ï¼Œæº¢å‡º = æœªå®šä¹‰è¡Œä¸ºï¼ˆUBï¼‰ = å®‰å…¨æ¼æ´**ã€‚

---

### ğŸ“š å››ã€çŸ¥è¯†ç‚¹åˆ†è§£

#### 1. `strlen`
- **è¡Œä¸º**ï¼š
  ```cpp
  size_t strlen(const char* s) {
      const char* p = s;
      while (*p != '\0') ++p;
      return p - s;
  }
  ```
- **é£é™©**ï¼š
  - è‹¥ `s` æ—  `\0` â†’ **æ— é™å¾ªç¯æˆ–è¯»è¶Šç•Œ**ï¼ˆUBï¼‰
  - å¸¸è§äºï¼šæœªç»ˆæ­¢çš„ `char[]`ã€æŸåçš„å­—ç¬¦ä¸²

#### 2. `strcpy`
- **è¡Œä¸º**ï¼š
  ```cpp
  char* strcpy(char* dst, const char* src) {
      char* ret = dst;
      while ((*dst++ = *src++) != '\0') ; // å¤åˆ¶ç›´åˆ° '\0'
      return ret;
  }
  ```
- **é£é™©**ï¼š
  - **ä¸æ£€æŸ¥ `dst` å¤§å°** â†’ è‹¥ `strlen(src) >= dst_size` â†’ **ç¼“å†²åŒºæº¢å‡º**
  - **æœ€å±é™©å‡½æ•°**ï¼šå†å²æ¼æ´ä¹‹æºï¼ˆå¦‚ Morris è •è™«ï¼‰

#### 3. `strcat`
- **è¡Œä¸º**ï¼š
  ```cpp
  char* strcat(char* dst, const char* src) {
      strcpy(dst + strlen(dst), src); // å…ˆæ‰¾ dst æœ«å°¾ï¼Œå† strcpy
      return dst;
  }
  ```
- **é£é™©**ï¼š
  - éœ€ä¸¤æ¬¡éå†ï¼ˆ`strlen` + `strcpy`ï¼‰
  - **æ€»é•¿åº¦ = strlen(dst) + strlen(src)**ï¼Œè‹¥è¶… `dst_size` â†’ **æº¢å‡º**

#### 4. `strcmp`
- **è¡Œä¸º**ï¼š
  ```cpp
  int strcmp(const char* s1, const char* s2) {
      while (*s1 && (*s1 == *s2)) { ++s1; ++s2; }
      return *(unsigned char*)s1 - *(unsigned char*)s2;
  }
  ```
- **é£é™©**ï¼š
  - ç›¸å¯¹å®‰å…¨ï¼ˆåªè¯»ï¼‰
  - ä½†ä»éœ€ `\0` ç»ˆæ­¢ï¼Œå¦åˆ™ UB

#### 5. â€œå®‰å…¨â€æ›¿ä»£å‡½æ•°ï¼ˆä»ä¸å®Œç¾ï¼‰
- **`strncpy`**ï¼š
  ```cpp
  char buf[5];
  strncpy(buf, "hello", 5); // buf = {'h','e','l','l','o'} â†’ **æ—  '\0'!**
  ```
  â†’ **å¿…é¡»æ‰‹åŠ¨åŠ  `\0`**ï¼š`buf[4] = '\0';`
- **`strncat`**ï¼š
  ```cpp
  strncat(dst, src, n); // æœ€å¤šè¿½åŠ  n å­—èŠ‚ï¼Œ**ä½†ä¼šåŠ  '\0'**
  // éœ€ç¡®ä¿ dst å‰©ä½™ç©ºé—´ >= n+1
  ```
- **`snprintf`**ï¼ˆæ¨èï¼‰ï¼š
  ```cpp
  char buf[10];
  snprintf(buf, sizeof(buf), "%s", "hello world"); // è‡ªåŠ¨æˆªæ–­+åŠ  '\0'
  ```

#### 6. ä¸ Java çš„å¯¹æ¯”
| å‡½æ•° | C é£æ ¼ | Java |
|------|--------|------|
| **å¤åˆ¶** | `strcpy`ï¼ˆå±é™©ï¼‰ | `String s2 = s1;`ï¼ˆå®‰å…¨å¼•ç”¨ï¼‰ |
| **è¿æ¥** | `strcat`ï¼ˆå±é™©ï¼‰ | `s1 + s2`ï¼ˆå®‰å…¨æ–°å¯¹è±¡ï¼‰ |
| **é•¿åº¦** | `strlen`ï¼ˆéœ€ `\0`ï¼‰ | `s.length()`ï¼ˆå…ƒæ•°æ®ï¼‰ |
| **æ¯”è¾ƒ** | `strcmp`ï¼ˆéœ€ `\0`ï¼‰ | `s1.equals(s2)`ï¼ˆå®‰å…¨ï¼‰ |

#### 7. ç°ä»£ C++ æœ€ä½³å®è·µ
- **ç»å¯¹ç¦æ­¢**ï¼š`strcpy`, `strcat`, `gets`
- **æ–°ä»£ç **ï¼š`std::string`
  ```cpp
  std::string dst = src; // å®‰å…¨
  dst += more;           // å®‰å…¨
  ```
- **C äº¤äº’**ï¼š
  ```cpp
  // è¾“å…¥ï¼šconst char* â†’ std::string
  void c_interface(const char* input) {
      std::string s(input); // å®‰å…¨å¤åˆ¶
      // ...
  }
  
  // è¾“å‡ºï¼šstd::string â†’ const char*
  const char* get_c_str() {
      static std::string s = "result";
      return s.c_str(); // æ³¨æ„ç”Ÿå‘½å‘¨æœŸï¼
  }
  ```
- **é—ç•™ä»£ç **ï¼šç”¨ `snprintf` æˆ– `strncpy` + æ‰‹åŠ¨ `\0`

> ğŸ’¡ **å®‰å…¨ç¼–ç é“å¾‹**ï¼š  
> **â€œæ°¸è¿œä¸è¦ç”¨ strcpy/strcatï¼›ç”¨ std::string æˆ– snprintfâ€**

---

### ğŸ’» äº”ã€åŠ¨æ‰‹ä¸ºç‹ï¼šå¯è¿è¡Œç¤ºä¾‹

#### ç¤ºä¾‹ 1ï¼šå±é™©å‡½æ•°æ¼”ç¤ºï¼ˆUBï¼ï¼‰
```cpp
#include <iostream>
#include <cstring>

int main() {
    char small[5];
    
    // å±é™©ï¼šstrcpy æº¢å‡º
    // strcpy(small, "hello world"); // UB! å–æ¶ˆæ³¨é‡Šå¯èƒ½ crash
    
    // å±é™©ï¼šæœªç»ˆæ­¢
    char bad[5] = "hello"; // æ—  '\0'
    // std::cout << bad; // UB!
    
    std::cout << "These are dangerous!\n";
    return 0;
}
```

#### ç¤ºä¾‹ 2ï¼šå®‰å…¨æ›¿ä»£ï¼ˆsnprintfï¼‰
```cpp
#include <iostream>
#include <cstdio> // snprintf

int main() {
    char buf[10];
    
    // å®‰å…¨ï¼šè‡ªåŠ¨æˆªæ–­ + åŠ  '\0'
    snprintf(buf, sizeof(buf), "%s", "hello world");
    std::cout << "buf: '" << buf << "'\n"; // "hello wor"
    
    // å®‰å…¨ï¼šè¿æ¥
    snprintf(buf, sizeof(buf), "%s %s", "Hello", "C++");
    std::cout << "buf: '" << buf << "'\n"; // "Hello C++"
    
    return 0;
}
```

#### ç¤ºä¾‹ 3ï¼šç°ä»£ C++ï¼ˆstd::stringï¼‰
```cpp
#include <iostream>
#include <string>

int main() {
    std::string s1 = "Hello";
    std::string s2 = "world";
    
    std::string combined = s1 + " " + s2; // å®‰å…¨
    std::cout << "combined: " << combined << "\n"; // "Hello world"
    
    // å®‰å…¨å¤åˆ¶
    std::string copy = combined;
    return 0;
}
```

---

### ğŸ“ å…­ã€åˆ†å±‚ç»ƒä¹ é¢˜

#### ğŸ”¹ åŸºç¡€é¢˜
1. **é£é™©è¯†åˆ«**  
   - è§£é‡Š `strcpy(dst, src)` çš„ä¸»è¦é£é™©

2. **å®‰å…¨å¤åˆ¶**  
   - ç”¨ `snprintf` å®‰å…¨å¤åˆ¶ "Hello" åˆ° `buf[10]`

#### ğŸ”¸ è¿›é˜¶é¢˜
3. **strncpy é™·é˜±**  
   - ç”¨ `strncpy(buf, "hello", 5)` åï¼Œæ‰‹åŠ¨ç¡®ä¿ `\0` ç»ˆæ­¢

4. **C äº¤äº’**  
   - ç¼–å†™å‡½æ•° `void safe_print(const char* s)`ï¼Œå†…éƒ¨è½¬ `std::string` æ‰“å°

#### âš ï¸ é™·é˜±é¢˜ï¼ˆJava è¿ç§»è¯¯åŒºï¼‰
5. **â€œstrncpy æ˜¯å®‰å…¨çš„å§ï¼Ÿâ€**  
   - Q: `strncpy(buf, "hello", 5)` åï¼Œ`buf` æ˜¯æœ‰æ•ˆçš„ C å­—ç¬¦ä¸²å—ï¼Ÿ  
   - A: âŒ **ä¸æ˜¯**ï¼  
     â†’ `buf = {'h','e','l','l','o'}`ï¼Œ**æ—  `\0`** â†’ éæ³•å­—ç¬¦ä¸²

6. **â€œC å‡½æ•°å’Œ Java ä¸€æ ·å®‰å…¨å§ï¼Ÿâ€**  
   - Q: `strcmp(s1, s2)` ä¼šæ£€æŸ¥è¾¹ç•Œå—ï¼Ÿ  
   - A: âŒ **ä¸ä¼š**ï¼  
     â†’ è‹¥ `s1` æˆ– `s2` æ—  `\0` â†’ **UBï¼ˆè¯»è¶Šç•Œï¼‰**

---

### âš ï¸ ä¸ƒã€æ³¨æ„äº‹é¡¹ä¸å»ºè®®

| é—®é¢˜ | å»ºè®® |
|------|------|
| **strcpy/strcat** | ç¦æ­¢ä½¿ç”¨ï¼ˆç¼–è¯‘å™¨è­¦å‘Šï¼š`-Wstringop-overflow`ï¼‰ |
| **strncpy** | ç”¨åæ‰‹åŠ¨åŠ  `\0`ï¼š`buf[size-1] = '\0';` |
| **snprintf** | ä¼˜å…ˆä½¿ç”¨ï¼ˆC99 æ ‡å‡†ï¼‰ |
| **ç°ä»£æ›¿ä»£** | `std::string` æ˜¯é»˜è®¤é€‰æ‹© |
| **è°ƒè¯•** | ç”¨ AddressSanitizer æ£€æµ‹æº¢å‡º |

> ğŸ’¡ **ç°ä»£ C++ é»„é‡‘æ³•åˆ™**ï¼š  
> **â€œæ–°ä»£ç é›¶ strcpyï¼›C äº¤äº’ç”¨ snprintf æˆ– std::stringâ€**

---

### ğŸ” å…«ã€èºæ—‹å¤ä¹ 

- **è¡”æ¥ 1.7.3**ï¼šC å­—ç¬¦ä¸²ä¾èµ– `\0` ç»ˆæ­¢
- **è¡”æ¥ 1.4.6**ï¼šç¼“å†²åŒºæº¢å‡ºæ˜¯æ‚¬ç©ºæŒ‡é’ˆçš„â€œå…„å¼Ÿé—®é¢˜â€
- **Java ç»éªŒ**ï¼šC å‡½æ•°æ— è¿è¡Œæ—¶ä¿æŠ¤ï¼ŒJava æœ‰
- **å½“æ—¥å¤ä¹ **ï¼šé»˜å†™å››å¤§å‡½æ•°çš„é£é™©ä¸å®‰å…¨æ›¿ä»£

---

### ğŸ§  ä¹ã€ä¸»åŠ¨å­¦ä¹ ä»»åŠ¡

1. **è‡ªæˆ‘æé—®**ï¼š
   - â€œä¸ºä»€ä¹ˆ C æ ‡å‡†åº“ä¸æä¾›å®‰å…¨å­—ç¬¦ä¸²å‡½æ•°ï¼Ÿâ€
   - â€œ`snprintf` å¦‚ä½•ä¿è¯å®‰å…¨ï¼Ÿâ€
2. **æ¦‚å¿µå›¾**ï¼šç”»å‡º `strcpy` vs `snprintf` vs `std::string` çš„å®‰å…¨å¯¹æ¯”
3. **æ‰®æ¼”æ•™å¸ˆ**ï¼šå‘åŒäº‹è§£é‡Šâ€œä¸ºä»€ä¹ˆ Heartbleed æ¼æ´æºäº C å­—ç¬¦ä¸²å¤„ç†â€

---

### ğŸ” åã€å¤ç›˜æ¸…å•

âœ… æˆ‘èƒ½è¯´å‡º strcpy/strcat çš„ä¸»è¦é£é™©  
âœ… æˆ‘çŸ¥é“ strncpy çš„é™·é˜±ï¼ˆæ—  '\0'ï¼‰  
âœ… æˆ‘ä¼šç”¨ snprintf å®‰å…¨æ›¿ä»£  
âœ… æˆ‘ä¼˜å…ˆä½¿ç”¨ std::string  
âœ… æˆ‘æ˜ç™½ C ä¸ Java å­—ç¬¦ä¸²å®‰å…¨çš„æ ¹æœ¬å·®å¼‚

> ğŸ¯ **è¾¾æ ‡æ ‡å‡†**ï¼šå®ŒæˆåŸºç¡€é¢˜ + æ­£ç¡®åˆ†æé™·é˜±é¢˜ 5 å’Œ 6

---

## ğŸš€ ä¸‹ä¸€æ­¥å»ºè®®

ä½ å·²æŒæ¡ **C++ C å­—ç¬¦ä¸²å‡½æ•°çš„é£é™©ä¸é˜²å¾¡**ï¼

æ¥ä¸‹æ¥ä½ å¯ä»¥ï¼š
1. **ç»§ç»­å­¦ä¹  1.7.5 ç¼“å†²åŒºæº¢å‡ºï¼ˆBuffer Overflowï¼‰åŸç†ä¸å±å®³**
2. **è¯·æ±‚ç”Ÿæˆã€ŒC å­—ç¬¦ä¸²å®‰å…¨å‡½æ•°é€ŸæŸ¥å¡ã€**
3. **è·³è½¬åˆ°ç»ƒä¹ é¢˜ç­”æ¡ˆä¸è§£æ**

è¯·å‘Šè¯‰æˆ‘ä½ çš„é€‰æ‹©ï¼Œæˆ‘ä»¬å°†ç»§ç»­å‰è¡Œï¼