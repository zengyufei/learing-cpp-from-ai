å¤ªå¥½äº†ï¼æˆ‘ä»¬ç°åœ¨è¿›å…¥ **1.2.2ï¼šæµ®ç‚¹ç±»å‹ â€” float, double, long double**ã€‚

è¿™æ˜¯ C++ æ•°å€¼ç±»å‹çš„å¦ä¸€åŠæ ¸å¿ƒã€‚è™½ç„¶ä½ ç†Ÿæ‚‰ Java çš„ `float` å’Œ `double`ï¼Œä½† C++ çš„ `long double`ã€å¹³å°å·®å¼‚ã€ä»¥åŠ**æ— æ ‡å‡†å¤æ•°/åè¿›åˆ¶ç±»å‹**ï¼Œä»ä¼šå¸¦æ¥æ–°çš„è®¤çŸ¥æŒ‘æˆ˜ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œ**æµ®ç‚¹æ•°çš„ç²¾åº¦é™·é˜±åœ¨ C++ å’Œ Java ä¸­åŒæ ·å­˜åœ¨**ï¼Œä½† C++ ç¼ºå°‘è¿è¡Œæ—¶ä¿æŠ¤ï¼Œé”™è¯¯æ›´éšè”½ã€‚

æˆ‘ä»¬å°†ç»§ç»­ä¸¥æ ¼éµå¾ªä½ çš„å­¦ä¹ åå¥½ï¼š
- âœ… SMART ç›®æ ‡  
- âœ… ç»“æ„å…ˆè¡Œï¼ˆç±»å‹åœ°å›¾ï¼‰  
- âœ… ç”Ÿæ´»åŒ–æ¯”å–»  
- âœ… åŠ¨æ‰‹ä¸ºç‹ï¼ˆå«åŸºç¡€/è¿›é˜¶/é™·é˜±é¢˜ï¼‰  
- âœ… èºæ—‹å¤ä¹ ï¼ˆè¡”æ¥ Java ç»éªŒ + 1.2.1 æ•´æ•°ç±»å‹ï¼‰  
- âœ… ä¸»åŠ¨å­¦ä¹  + å¤ç›˜

---

## ğŸ¯ KU 1.2.2ï¼šæµ®ç‚¹ç±»å‹

> **æ‰€å±é˜¶æ®µ**ï¼šPhase 1 â€” C++ è¯­æ³•åŸºç¡€  
> **å‰ç½®çŸ¥è¯†**ï¼š1.2.1ï¼ˆæ•´æ•°ç±»å‹ï¼‰ã€Java æµ®ç‚¹ç»éªŒ  
> **åç»­è¡”æ¥**ï¼š1.2.8ï¼ˆç±»å‹å¤§å°ä¸å¯¹é½ï¼‰ã€3.8ï¼ˆconstexprï¼‰  
> **é¢„è®¡è€—æ—¶**ï¼š3â€“4 å°æ—¶

---

### ğŸ§­ ä¸€ã€ç»“æ„å…ˆè¡Œï¼šC++ æµ®ç‚¹ç±»å‹åœ°å›¾

```
1.2.2 æµ®ç‚¹ç±»å‹
â”œâ”€â”€ 1. floatï¼ˆå•ç²¾åº¦ï¼‰
â”œâ”€â”€ 2. doubleï¼ˆåŒç²¾åº¦ï¼‰
â”œâ”€â”€ 3. long doubleï¼ˆæ‰©å±•ç²¾åº¦ï¼‰
â”œâ”€â”€ 4. å…³é”®ç‰¹æ€§
â”‚   â”œâ”€â”€ 4.1 IEEE 754 æ ‡å‡†ï¼ˆé€šå¸¸ï¼‰
â”‚   â”œâ”€â”€ 4.2 ç²¾åº¦ä¸èŒƒå›´
â”‚   â”œâ”€â”€ 4.3 å¹³å°å·®å¼‚ï¼ˆå°¤å…¶ long doubleï¼‰
â”‚   â””â”€â”€ 4.4 ä¸ Java çš„å¯¹æ¯”
â”œâ”€â”€ 5. å¸¸è§é™·é˜±
â”‚   â”œâ”€â”€ 5.1 ç›¸ç­‰æ¯”è¾ƒé™·é˜±
â”‚   â”œâ”€â”€ 5.2 ç²¾åº¦ä¸¢å¤±
â”‚   â””â”€â”€ 5.3 ç‰¹æ®Šå€¼ï¼šNaN, Inf
â””â”€â”€ 6. æœ€ä½³å®è·µ
    â”œâ”€â”€ 6.1 ä½•æ—¶ç”¨ float/double/long double
    â””â”€â”€ 6.2 å®‰å…¨æ¯”è¾ƒæ–¹æ³•
```

---

### ğŸ¯ äºŒã€SMART å­¦ä¹ ç›®æ ‡

- **Specific**ï¼šèƒ½æ­£ç¡®ä½¿ç”¨ `float`ã€`double`ã€`long double`ï¼Œç†è§£å…¶ç²¾åº¦ã€èŒƒå›´ã€å¹³å°å·®å¼‚ï¼Œå¹¶é¿å…å¸¸è§æµ®ç‚¹é™·é˜±ã€‚
- **Measurable**ï¼šå®Œæˆ 3 é“åŸºç¡€é¢˜ + 2 é“é™·é˜±é¢˜ï¼Œèƒ½è§£é‡Šä¸ºä½• `0.1 + 0.2 != 0.3`ã€‚
- **Achievable**ï¼šé€šè¿‡â€œå°ºå­ç²¾åº¦â€æ¯”å–»ç†è§£æµ®ç‚¹è¡¨ç¤ºã€‚
- **Relevant**ï¼šè¿™æ˜¯ç§‘å­¦è®¡ç®—ã€å›¾å½¢ç¼–ç¨‹ã€é‡‘èåº”ç”¨çš„åŸºç¡€ã€‚
- **Time-bound**ï¼š2 å¤©å†…å®Œæˆã€‚

---

### ğŸŒ ä¸‰ã€ç”Ÿæ´»åŒ–æ¯”å–»ï¼šä¸åŒç²¾åº¦çš„æµ‹é‡å°º

> æƒ³è±¡ä½ è¦æµ‹é‡ä¸€æ ¹æœ¨æ£çš„é•¿åº¦ï¼š
>
> - **`float`** = æ¯«ç±³å°ºï¼ˆç²¾åº¦çº¦ 7 ä½åè¿›åˆ¶æ•°å­—ï¼‰  
>   â†’ èƒ½æµ‹ 1234.567 cmï¼Œä½† 1234.5678 cm ä¼šå››èˆäº”å…¥
>
> - **`double`** = å¾®ç±³æ¿€å…‰å°ºï¼ˆç²¾åº¦çº¦ 15â€“17 ä½ï¼‰  
>   â†’ èƒ½æµ‹ 1234.56789012345 cm
>
> - **`long double`** = çº³ç±³å¹²æ¶‰ä»ªï¼ˆç²¾åº¦ â‰¥18 ä½ï¼Œå¹³å°ç›¸å…³ï¼‰  
>   â†’ åœ¨ x86 ä¸Šå¯èƒ½æ˜¯ 80 ä½ï¼ˆ64 ä½æœ‰æ•ˆï¼‰ï¼Œåœ¨ ARM ä¸Šå¯èƒ½ç­‰äº `double`
>
> - **å…³é”®é—®é¢˜**ï¼š  
>   æ— è®ºå¤šç²¾å¯†ï¼Œ**å°ºå­åªèƒ½è¡¨ç¤ºâ€œåˆ»åº¦çº¿ä¸Šçš„å€¼â€**ã€‚  
>   0.1 ç±³åœ¨äºŒè¿›åˆ¶ä¸­æ˜¯**æ— é™å¾ªç¯å°æ•°** â†’ **å¿…ç„¶æœ‰èˆå…¥è¯¯å·®**ï¼

> ğŸ’¡ **æ ¸å¿ƒè®¤çŸ¥**ï¼š**æµ®ç‚¹æ•°æ˜¯å®æ•°çš„è¿‘ä¼¼ï¼Œä¸æ˜¯ç²¾ç¡®å€¼**ã€‚

---

### ğŸ“š å››ã€çŸ¥è¯†ç‚¹åˆ†è§£

#### 1. ä¸‰ç§æµ®ç‚¹ç±»å‹ï¼ˆC++ æ ‡å‡†è¦æ±‚ï¼‰

| ç±»å‹ | æœ€å°ç²¾åº¦ | å…¸å‹å®ç°ï¼ˆIEEE 754ï¼‰ | å…¸å‹å¤§å° |
|------|--------|---------------------|--------|
| `float` | 6 ä½åè¿›åˆ¶ | binary32 | 4 å­—èŠ‚ |
| `double` | 10 ä½åè¿›åˆ¶ | binary64 | 8 å­—èŠ‚ |
| `long double` | 10 ä½åè¿›åˆ¶ | x86: binary80<br>others: binary64 | 8â€“16 å­—èŠ‚ |

> âš ï¸ **`long double` æ˜¯ C++ ä¸ Java çš„å…³é”®å·®å¼‚**ï¼š  
> - **Java**ï¼šåªæœ‰ `float`ï¼ˆ32 ä½ï¼‰å’Œ `double`ï¼ˆ64 ä½ï¼‰  
> - **C++**ï¼šé¢å¤–æä¾› `long double`ï¼ˆå¹³å°ç›¸å…³ï¼‰

#### 2. IEEE 754 æ ‡å‡†ï¼ˆé€šå¸¸éµå¾ªï¼‰
- ç¬¦å·ä½ + æŒ‡æ•° + å°¾æ•°
- ç‰¹æ®Šå€¼ï¼š
  - **+Inf / -Inf**ï¼šæº¢å‡ºç»“æœï¼ˆå¦‚ `1.0 / 0.0`ï¼‰
  - **NaN**ï¼ˆNot a Numberï¼‰ï¼šæ— æ•ˆæ“ä½œç»“æœï¼ˆå¦‚ `0.0 / 0.0`ã€`sqrt(-1)`ï¼‰

#### 3. ä¸ Java çš„å¯¹æ¯”
| ç‰¹æ€§ | C++ | Java |
|------|-----|------|
| **æµ®ç‚¹ç±»å‹** | `float`, `double`, `long double` | `float`, `double` |
| **`long double`** | å¹³å°ç›¸å…³ï¼ˆx86: 80 ä½ï¼‰ | **ä¸å­˜åœ¨** |
| **å­—é¢é‡åç¼€** | `f`ï¼ˆfloatï¼‰ï¼Œæ— åç¼€ï¼ˆdoubleï¼‰ | `f`ï¼ˆfloatï¼‰ï¼Œæ— åç¼€ï¼ˆdoubleï¼‰ |
| **ç‰¹æ®Šå€¼** | `INFINITY`, `NAN`ï¼ˆC99ï¼‰<br>`std::numeric_limits`ï¼ˆC++ï¼‰ | `Float.POSITIVE_INFINITY` ç­‰ |
| **ä¸¥æ ¼æµ®ç‚¹** | é»˜è®¤ä¸ä¸¥æ ¼ï¼ˆå¯ä¼˜åŒ–ï¼‰ | `strictfp`ï¼ˆå·²å¼ƒç”¨ï¼‰ |

#### 4. å¸¸è§é™·é˜±
- **ç›¸ç­‰æ¯”è¾ƒ**ï¼š
  ```cpp
  double a = 0.1 + 0.2;
  double b = 0.3;
  if (a == b) { /* å¯èƒ½ä¸æˆç«‹ï¼ */ }
  ```
- **ç²¾åº¦ä¸¢å¤±**ï¼š
  ```cpp
  float f = 16777217; // è¶…å‡º float ç²¾åº¦
  std::cout << f; // è¾“å‡º 16777216ï¼
  ```
- **NaN ä¼ æ’­**ï¼šä»»ä½•å« NaN çš„è¿ç®—ç»“æœéƒ½æ˜¯ NaN
- **Inf è¿ç®—**ï¼š`Inf - Inf = NaN`ï¼Œ`Inf / Inf = NaN`

#### 5. å®‰å…¨æ¯”è¾ƒæ–¹æ³•
```cpp
#include <cmath>
bool approx_equal(double a, double b, double epsilon = 1e-9) {
    return std::abs(a - b) < epsilon;
}
```

---

### ğŸ’» äº”ã€åŠ¨æ‰‹ä¸ºç‹ï¼šå¯è¿è¡Œç¤ºä¾‹

#### ç¤ºä¾‹ 1ï¼šæµ®ç‚¹ç²¾åº¦å®éªŒ
```cpp
#include <iostream>
#include <iomanip>
#include <cmath>

int main() {
    // 0.1 + 0.2 != 0.3 ?
    double a = 0.1;
    double b = 0.2;
    double c = a + b;
    double d = 0.3;

    std::cout << std::setprecision(17);
    std::cout << "a = " << a << "\n";
    std::cout << "b = " << b << "\n";
    std::cout << "c = " << c << "\n";
    std::cout << "d = " << d << "\n";
    std::cout << "c == d: " << std::boolalpha << (c == d) << "\n";

    // å®‰å…¨æ¯”è¾ƒ
    bool equal = std::abs(c - d) < 1e-15;
    std::cout << "approx equal: " << equal << "\n";
    return 0;
}
```

#### ç¤ºä¾‹ 2ï¼šç‰¹æ®Šå€¼
```cpp
#include <iostream>
#include <limits>
#include <cmath>

int main() {
    double inf = std::numeric_limits<double>::infinity();
    double nan = std::numeric_limits<double>::quiet_NaN();

    std::cout << "inf = " << inf << "\n";
    std::cout << "nan = " << nan << "\n";
    std::cout << "inf + 1 = " << inf + 1 << "\n";
    std::cout << "inf - inf = " << inf - inf << "\n"; // NaN
    std::cout << "nan == nan: " << (nan == nan) << "\n"; // false!
    return 0;
}
```

#### ç¤ºä¾‹ 3ï¼šlong double å¹³å°å·®å¼‚
```cpp
#include <iostream>
int main() {
    std::cout << "sizeof(float):       " << sizeof(float) << "\n";
    std::cout << "sizeof(double):      " << sizeof(double) << "\n";
    std::cout << "sizeof(long double): " << sizeof(long double) << "\n";
    return 0;
}
```
> ğŸ“Œ åœ¨ x86 Linux ä¸Šï¼š`long double` = 16 å­—èŠ‚ï¼ˆä½†æœ‰æ•ˆä½ 80ï¼‰  
> åœ¨ macOS/ARM æˆ– Windowsï¼šå¯èƒ½ = 8 å­—èŠ‚ï¼ˆåŒ doubleï¼‰

---

### ğŸ“ å…­ã€åˆ†å±‚ç»ƒä¹ é¢˜

#### ğŸ”¹ åŸºç¡€é¢˜
1. **ç²¾åº¦å®éªŒ**  
   - è¿è¡Œ 0.1+0.2 ç¤ºä¾‹ï¼Œè®°å½•è¾“å‡º  
   - ç”¨ `approx_equal` éªŒè¯æ˜¯å¦â€œè¿‘ä¼¼ç›¸ç­‰â€

2. **ç‰¹æ®Šå€¼æ£€æµ‹**  
   - ç¼–å†™å‡½æ•° `bool is_nan(double x)`ï¼Œä½¿ç”¨ `std::isnan(x)`

#### ğŸ”¸ è¿›é˜¶é¢˜
3. **å¹³å°è°ƒæŸ¥**  
   - åœ¨ä½ çš„æœºå™¨ä¸Šè¿è¡Œ `sizeof(long double)`  
   - æŸ¥è¯¢æ˜¯å¦æ”¯æŒ 80 ä½æ‰©å±•ç²¾åº¦ï¼ˆx86 é€šå¸¸æ”¯æŒï¼‰

4. **ç²¾åº¦ä¸¢å¤±å®éªŒ**  
   - å°† `16777217` èµ‹å€¼ç»™ `float`ï¼Œè¾“å‡ºç»“æœ  
   - è§£é‡Šä¸ºä½•å˜æˆ `16777216`

#### âš ï¸ é™·é˜±é¢˜ï¼ˆJava è¿ç§»è¯¯åŒºï¼‰
5. **â€œæˆ‘ä»¥ä¸º == èƒ½æ¯”è¾ƒæµ®ç‚¹æ•°â€**  
   - Q: ä»¥ä¸‹ä»£ç åœ¨ Java å’Œ C++ ä¸­è¡Œä¸ºæ˜¯å¦ç›¸åŒï¼Ÿ
     ```java
     // Java
     if (0.1 + 0.2 == 0.3) { ... }
     ```
     ```cpp
     // C++
     if (0.1 + 0.2 == 0.3) { ... }
     ```
   - A: âœ… **ç›¸åŒ**ï¼ä¸¤è€…éƒ½åŸºäº IEEE 754ï¼Œç»“æœéƒ½ä¸º `false`

6. **â€œlong double æ›´ç²¾ç¡®ï¼Ÿâ€**  
   - Q: åœ¨ ARM Mac ä¸Šï¼Œ`long double` æ¯” `double` æ›´ç²¾ç¡®å—ï¼Ÿ  
   - A: âŒ å¦ï¼Apple Clang å°† `long double` å®ç°ä¸º `double`

---

### âš ï¸ ä¸ƒã€æ³¨æ„äº‹é¡¹ä¸å»ºè®®

| é—®é¢˜ | å»ºè®® |
|------|------|
| **æµ®ç‚¹æ¯”è¾ƒ** | æ°¸è¿œä¸è¦ç”¨ `==`ï¼Œç”¨ `abs(a-b) < epsilon` |
| **epsilon é€‰æ‹©** | æ ¹æ®æ•°å€¼å¤§å°åŠ¨æ€è°ƒæ•´ï¼ˆæˆ–ç”¨ ULP æ–¹æ³•ï¼‰ |
| **NaN æ£€æŸ¥** | ç”¨ `std::isnan()`ï¼Œä¸è¦ç”¨ `x != x`ï¼ˆè™½æœ‰æ•ˆä½†ä¸æ¸…æ™°ï¼‰ |
| **é‡‘èè®¡ç®—** | é¿å…æµ®ç‚¹ï¼ç”¨æ•´æ•°ï¼ˆåˆ†ï¼‰æˆ–åè¿›åˆ¶åº“ |
| **æ€§èƒ½ vs ç²¾åº¦** | `float` æ›´å¿«ä½†ç²¾åº¦ä½ï¼Œ`double` æ˜¯é»˜è®¤é€‰æ‹© |

> ğŸ’¡ **ç°ä»£ C++ å»ºè®®**ï¼š
> - **é»˜è®¤ç”¨ `double`**ï¼ˆé™¤éå†…å­˜/æ€§èƒ½æ•æ„Ÿï¼‰
> - **é¿å… `long double`**ï¼ˆé™¤éæ˜ç¡®éœ€è¦ä¸”éªŒè¯å¹³å°æ”¯æŒï¼‰
> - **ç§‘å­¦è®¡ç®—**ï¼šè€ƒè™‘ `std::complex`ã€Eigen ç­‰åº“

---

### ğŸ” å…«ã€èºæ—‹å¤ä¹ 

- **è¡”æ¥ 1.2.1**ï¼šæ•´æ•°æœ‰æº¢å‡º UBï¼Œæµ®ç‚¹æœ‰ Inf/NaN
- **Java ç»éªŒ**ï¼šæµ®ç‚¹é™·é˜±åœ¨ Java ä¸­åŒæ ·å­˜åœ¨ï¼Œä½† C++ æ— è¿è¡Œæ—¶è­¦å‘Š
- **å½“æ—¥å¤ä¹ **ï¼šé»˜å†™å®‰å…¨æ¯”è¾ƒå‡½æ•°
- **åç»­è¡”æ¥**ï¼š3.8ï¼ˆconstexprï¼‰ä¸­å¯åšç¼–è¯‘æœŸæµ®ç‚¹è®¡ç®—

---

### ğŸ§  ä¹ã€ä¸»åŠ¨å­¦ä¹ ä»»åŠ¡

1. **è‡ªæˆ‘æé—®**ï¼š
   - â€œä¸ºä»€ä¹ˆ 0.1 æ— æ³•ç²¾ç¡®è¡¨ç¤ºï¼Ÿâ€
   - â€œNaN ä¸ºä»€ä¹ˆä¸ç­‰äºè‡ªå·±ï¼Ÿâ€
2. **æ¦‚å¿µå›¾**ï¼šç”»å‡º IEEE 754 binary64 ç»“æ„ï¼ˆ1+11+52ï¼‰
3. **æ‰®æ¼”æ•™å¸ˆ**ï¼šå‘åŒäº‹è§£é‡Šâ€œä¸ºä»€ä¹ˆä¸èƒ½ç”¨æµ®ç‚¹æ•°è¡¨ç¤ºé‡‘é¢â€

---

### ğŸ” åã€å¤ç›˜æ¸…å•

âœ… æˆ‘èƒ½è¯´å‡º float/double/long double çš„å…¸å‹ç²¾åº¦  
âœ… æˆ‘ç†è§£ 0.1+0.2 != 0.3 çš„åŸå›   
âœ… æˆ‘ä¼šç”¨å®‰å…¨æ–¹æ³•æ¯”è¾ƒæµ®ç‚¹æ•°  
âœ… æˆ‘çŸ¥é“ long double çš„å¹³å°å·®å¼‚  
âœ… æˆ‘èƒ½å¤„ç† Inf å’Œ NaN

> ğŸ¯ **è¾¾æ ‡æ ‡å‡†**ï¼šå®ŒæˆåŸºç¡€é¢˜ + æ­£ç¡®åˆ†æé™·é˜±é¢˜ 5 å’Œ 6

---

## ğŸš€ ä¸‹ä¸€æ­¥å»ºè®®

ä½ å·²æŒæ¡ **C++ æµ®ç‚¹ç±»å‹çš„æ ¸å¿ƒçŸ¥è¯†**ï¼

æ¥ä¸‹æ¥ä½ å¯ä»¥ï¼š
1. **ç»§ç»­å­¦ä¹  1.2.3 ç±»å‹åˆ«åï¼štypedef vs usingï¼ˆC++11ï¼‰**
2. **è¯·æ±‚ç”Ÿæˆã€Œæµ®ç‚¹é™·é˜±é€ŸæŸ¥å¡ã€**
3. **è·³è½¬åˆ°ç»ƒä¹ é¢˜ç­”æ¡ˆä¸è§£æ**

è¯·å‘Šè¯‰æˆ‘ä½ çš„é€‰æ‹©ï¼Œæˆ‘ä»¬å°†ç»§ç»­å‰è¡Œï¼