å¤ªå¥½äº†ï¼æˆ‘ä»¬ç°åœ¨è¿›å…¥ **2.1.4ï¼šå¯¹è±¡ç”Ÿå‘½å‘¨æœŸ â€” åˆ›å»ºï¼ˆæ ˆ/å †ï¼‰ã€ä½œç”¨åŸŸç»“æŸã€é”€æ¯**ã€‚

è¿™æ˜¯ C++ **èµ„æºç®¡ç†**çš„åŸºçŸ³ï¼Œä¹Ÿæ˜¯ä¸ Java **æœ€æ ¹æœ¬çš„å·®å¼‚**ä¹‹ä¸€ã€‚ä½œä¸º Java å¼€å‘è€…ï¼Œä½ ä¹ æƒ¯ GC è‡ªåŠ¨ç®¡ç†å¯¹è±¡ç”Ÿå‘½å‘¨æœŸï¼Œè€Œ C++ çš„**ç¡®å®šæ€§ææ„**ï¼ˆDeterministic Destructionï¼‰è®©ä½ èƒ½**ç²¾ç¡®æ§åˆ¶èµ„æºé‡Šæ”¾æ—¶æœº**ã€‚ç†è§£å¯¹è±¡ç”Ÿå‘½å‘¨æœŸï¼Œæ˜¯æŒæ¡ RAIIï¼ˆResource Acquisition Is Initializationï¼‰å’Œç¼–å†™å®‰å…¨ C++ ä»£ç çš„å…³é”®ã€‚

æˆ‘ä»¬å°†ç»§ç»­ä¸¥æ ¼éµå¾ªä½ çš„å­¦ä¹ åå¥½ï¼š
- âœ… SMART ç›®æ ‡  
- âœ… ç»“æ„å…ˆè¡Œï¼ˆç”Ÿå‘½å‘¨æœŸåœ°å›¾ï¼‰  
- âœ… ç”Ÿæ´»åŒ–æ¯”å–»  
- âœ… åŠ¨æ‰‹ä¸ºç‹ï¼ˆå«åŸºç¡€/è¿›é˜¶/é™·é˜±é¢˜ï¼‰  
- âœ… èºæ—‹å¤ä¹ ï¼ˆè¡”æ¥ Phase 1 + Java ç»éªŒï¼‰  
- âœ… ä¸»åŠ¨ learning + å¤ç›˜

---

## ğŸ¯ KU 2.1.4ï¼šå¯¹è±¡ç”Ÿå‘½å‘¨æœŸ

> **æ‰€å±é˜¶æ®µ**ï¼šPhase 2 â€” é¢å‘å¯¹è±¡ç¼–ç¨‹  
> **å‰ç½®çŸ¥è¯†**ï¼š1.4ï¼ˆå†…å­˜ç®¡ç†ï¼‰ã€2.1.1â€“2.1.3ï¼ˆç±»åŸºç¡€ï¼‰ã€Java GC ç»éªŒ  
> **åç»­è¡”æ¥**ï¼š2.3ï¼ˆRAIIï¼‰ã€2.4ï¼ˆæ‹·è´è¯­ä¹‰ï¼‰  
> **é¢„è®¡è€—æ—¶**ï¼š3â€“4 å°æ—¶

---

### ğŸ§­ ä¸€ã€ç»“æ„å…ˆè¡Œï¼šç”Ÿå‘½å‘¨æœŸåœ°å›¾

```
2.1.4 å¯¹è±¡ç”Ÿå‘½å‘¨æœŸ
â”œâ”€â”€ 1. åˆ›å»ºæ–¹å¼
â”‚   â”œâ”€â”€ 1.1 æ ˆå¯¹è±¡ï¼šMyClass obj;ï¼ˆè‡ªåŠ¨å­˜å‚¨ï¼‰
â”‚   â”œâ”€â”€ 1.2 å †å¯¹è±¡ï¼šnew MyClass()ï¼ˆåŠ¨æ€å­˜å‚¨ï¼‰
â”‚   â””â”€â”€ 1.3 ä¸´æ—¶å¯¹è±¡ï¼šMyClass()
â”œâ”€â”€ 2. ç”Ÿå‘½å‘¨æœŸè§„åˆ™
â”‚   â”œâ”€â”€ 2.1 æ ˆå¯¹è±¡ï¼šä½œç”¨åŸŸç»‘å®šï¼ˆç¡®å®šæ€§ææ„ï¼‰
â”‚   â”œâ”€â”€ 2.2 å †å¯¹è±¡ï¼šæ‰‹åŠ¨ç®¡ç†ï¼ˆnew/deleteï¼‰
â”‚   â””â”€â”€ 2.3 ä¸´æ—¶å¯¹è±¡ï¼šè¡¨è¾¾å¼ç»“æŸé”€æ¯
â”œâ”€â”€ 3. ææ„å‡½æ•°
â”‚   â”œâ”€â”€ 3.1 è¯­æ³•ï¼š~MyClass()
â”‚   â”œâ”€â”€ 3.2 ä½œç”¨ï¼šé‡Šæ”¾èµ„æºï¼ˆæ–‡ä»¶ã€å†…å­˜ã€é”ï¼‰
â”‚   â””â”€â”€ 3.3 è°ƒç”¨æ—¶æœºï¼šå¯¹è±¡é”€æ¯æ—¶è‡ªåŠ¨è°ƒç”¨
â”œâ”€â”€ 4. ä¸ Java çš„å¯¹æ¯”
â”‚   â”œâ”€â”€ 4.1 C++ï¼šç¡®å®šæ€§ææ„ï¼ˆRAIIï¼‰
â”‚   â””â”€â”€ 4.2 Javaï¼šéç¡®å®šæ€§ GCï¼ˆfinalize ä¸å¯é ï¼‰
â”œâ”€â”€ 5. å¸¸è§é™·é˜±
    â”œâ”€â”€ 5.1 å†…å­˜æ³„æ¼ï¼ˆå¿˜è®° deleteï¼‰
    â”œâ”€â”€ 5.2 æ‚¬ç©ºæŒ‡é’ˆï¼ˆdelete åä½¿ç”¨ï¼‰
    â””â”€â”€ 5.3 æ ˆæº¢å‡ºï¼ˆå¤§å¯¹è±¡æ”¾æ ˆï¼‰
â””â”€â”€ 6. ç°ä»£ C++ æœ€ä½³å®è·µ
    â”œâ”€â”€ 6.1 ä¼˜å…ˆæ ˆå¯¹è±¡
    â”œâ”€â”€ 6.2 å †å¯¹è±¡ç”¨æ™ºèƒ½æŒ‡é’ˆ
    â””â”€â”€ 6.3 RAII å°è£…èµ„æº
```

---

### ğŸ¯ äºŒã€SMART å­¦ä¹ ç›®æ ‡

- **Specific**ï¼šèƒ½æ­£ç¡®ç®¡ç†æ ˆ/å †å¯¹è±¡ç”Ÿå‘½å‘¨æœŸï¼Œç†è§£ææ„å‡½æ•°çš„ä½œç”¨ï¼Œå¹¶ä¸ Java GC å¯¹æ¯”ã€‚
- **Measurable**ï¼šå®Œæˆ 3 é“åŸºç¡€é¢˜ + 2 é“é™·é˜±é¢˜ï¼Œèƒ½è§£é‡Šä¸ºä½• C++ ææ„æ˜¯ç¡®å®šæ€§çš„ã€‚
- **Achievable**ï¼šé€šè¿‡â€œç§Ÿå€Ÿ vs è´­ä¹°â€æ¯”å–»ç†è§£ç”Ÿå‘½å‘¨æœŸã€‚
- **Relevant**ï¼šè¿™æ˜¯ç¼–å†™æ— æ³„æ¼ã€å®‰å…¨ C++ ä»£ç çš„åŸºç¡€ã€‚
- **Time-bound**ï¼š2 å¤©å†…å®Œæˆã€‚

---

### ğŸŒ ä¸‰ã€ç”Ÿæ´»åŒ–æ¯”å–»ï¼šç§Ÿå€Ÿ vs è´­ä¹°

> æƒ³è±¡è·å–ä¸€ä»¶å·¥å…·ï¼š
>
> - **æ ˆå¯¹è±¡ = ç§Ÿå€Ÿå·¥å…·**  
>   - è¿›å…¥ä½œç”¨åŸŸæ—¶**è‡ªåŠ¨ç§Ÿå€Ÿ**  
>   - ç¦»å¼€ä½œç”¨åŸŸæ—¶**è‡ªåŠ¨å½’è¿˜**  
>   - **ç¡®å®šæ€§**ï¼šç§ŸæœŸç²¾ç¡®ï¼ˆä½œç”¨åŸŸï¼‰
>
> - **å †å¯¹è±¡ = è´­ä¹°å·¥å…·**  
>   - `new` **è´­ä¹°**å·¥å…·  
>   - å¿…é¡»æ‰‹åŠ¨ `delete` **ä¸¢å¼ƒ**  
>   - **é£é™©**ï¼šå¿˜è®°ä¸¢å¼ƒï¼ˆå†…å­˜æ³„æ¼ï¼‰
>
> - **Java å¯¹æ¯”**ï¼š  
>   - Java = **å·¥å…·è‡ªåŠ¨å›æ”¶ç«™**  
>   - ä½ åªéœ€ä½¿ç”¨ï¼Œå›æ”¶ç«™ later æ¸…ç†  
>   - **ä¸ç¡®å®šæ€§**ï¼šæ¸…ç†æ—¶æœºæœªçŸ¥

> ğŸ’¡ **å…³é”®è®¤çŸ¥**ï¼š**C++ ç”Ÿå‘½å‘¨æœŸ = ä½ æ§åˆ¶ç§ŸæœŸï¼›Java ç”Ÿå‘½å‘¨æœŸ = å›æ”¶ç«™æ§åˆ¶æ¸…ç†**ã€‚

---

### ğŸ“š å››ã€çŸ¥è¯†ç‚¹åˆ†è§£

#### 1. åˆ›å»ºæ–¹å¼
- **æ ˆå¯¹è±¡**ï¼ˆè‡ªåŠ¨å­˜å‚¨ï¼‰ï¼š
  ```cpp
  void f() {
      MyClass obj; // æ ˆå¯¹è±¡
  } // obj è‡ªåŠ¨ææ„
  ```
- **å †å¯¹è±¡**ï¼ˆåŠ¨æ€å­˜å‚¨ï¼‰ï¼š
  ```cpp
  MyClass* p = new MyClass(); // å †å¯¹è±¡
  delete p;                   // æ‰‹åŠ¨ææ„
  ```
- **ä¸´æ—¶å¯¹è±¡**ï¼š
  ```cpp
  process(MyClass()); // ä¸´æ—¶å¯¹è±¡ï¼Œè¡¨è¾¾å¼ç»“æŸé”€æ¯
  ```

#### 2. ç”Ÿå‘½å‘¨æœŸè§„åˆ™
- **æ ˆå¯¹è±¡**ï¼š
  - **ä½œç”¨åŸŸç»‘å®š**ï¼šè¿›å…¥ä½œç”¨åŸŸæ„é€ ï¼Œç¦»å¼€ä½œç”¨åŸŸææ„
  - **ç¡®å®šæ€§**ï¼šææ„æ—¶æœºç¼–è¯‘æœŸç¡®å®š
- **å †å¯¹è±¡**ï¼š
  - **æ‰‹åŠ¨ç®¡ç†**ï¼š`new`/`delete` é…å¯¹
  - **é£é™©**ï¼šæ³„æ¼ã€æ‚¬ç©ºæŒ‡é’ˆ
- **ä¸´æ—¶å¯¹è±¡**ï¼š
  - **å®Œæ•´è¡¨è¾¾å¼ç»“æŸ**æ—¶é”€æ¯
  - **ä¾‹å¤–**ï¼š`const` å¼•ç”¨å»¶é•¿ç”Ÿå‘½å‘¨æœŸ

#### 3. ææ„å‡½æ•°
- **è¯­æ³•**ï¼š
  ```cpp
  class MyClass {
  public:
      ~MyClass() {
          // é‡Šæ”¾èµ„æºï¼ˆæ–‡ä»¶ã€å†…å­˜ç­‰ï¼‰
      }
  };
  ```
- **ä½œç”¨**ï¼š
  - é‡Šæ”¾éå†…å­˜èµ„æºï¼ˆæ–‡ä»¶å¥æŸ„ã€é”ã€ç½‘ç»œè¿æ¥ï¼‰
  - **ä¸æ˜¯**é‡Šæ”¾å¯¹è±¡è‡ªèº«å†…å­˜ï¼ˆç”± `delete` å¤„ç†ï¼‰
- **è°ƒç”¨æ—¶æœº**ï¼š
  - æ ˆå¯¹è±¡ï¼šç¦»å¼€ä½œç”¨åŸŸæ—¶
  - å †å¯¹è±¡ï¼š`delete` æ—¶
  - ä¸´æ—¶å¯¹è±¡ï¼šè¡¨è¾¾å¼ç»“æŸæ—¶

#### 4. ä¸ Java çš„å¯¹æ¯”
| ç‰¹æ€§ | C++ | Java |
|------|-----|------|
| **ç”Ÿå‘½å‘¨æœŸ** | ç¡®å®šæ€§ï¼ˆä½œç”¨åŸŸ/æ‰‹åŠ¨ï¼‰ | éç¡®å®šæ€§ï¼ˆGCï¼‰ |
| **èµ„æºé‡Šæ”¾** | ææ„å‡½æ•°ï¼ˆå¯é ï¼‰ | `finalize()`ï¼ˆä¸å¯é ï¼‰ |
| **å†…å­˜ç®¡ç†** | æ‰‹åŠ¨/RAII | GC è‡ªåŠ¨ |
| **æ€§èƒ½** | é›¶å¼€é”€ï¼ˆæ ˆå¯¹è±¡ï¼‰ | GC åœé¡¿ |

#### 5. å¸¸è§é™·é˜±
- **å†…å­˜æ³„æ¼**ï¼š
  ```cpp
  void leak() {
      MyClass* p = new MyClass(); // å¿˜è®° delete
  }
  ```
- **æ‚¬ç©ºæŒ‡é’ˆ**ï¼š
  ```cpp
  MyClass* p = new MyClass();
  delete p;
  // p->method(); // UB! æ‚¬ç©ºæŒ‡é’ˆ
  ```
- **æ ˆæº¢å‡º**ï¼š
  ```cpp
  void overflow() {
      MyClass huge[1000000]; // æ ˆæº¢å‡º
  }
  ```

#### 6. ç°ä»£ C++ æœ€ä½³å®è·µ
- **ä¼˜å…ˆæ ˆå¯¹è±¡**ï¼š
  - å°å¯¹è±¡ã€ä½œç”¨åŸŸå†…ä½¿ç”¨
- **å †å¯¹è±¡ç”¨æ™ºèƒ½æŒ‡é’ˆ**ï¼š
  ```cpp
  std::unique_ptr<MyClass> p = std::make_unique<MyClass>();
  // è‡ªåŠ¨ delete
  ```
- **RAII å°è£…èµ„æº**ï¼š
  ```cpp
  class FileHandle {
      FILE* file_;
  public:
      FileHandle(const char* name) : file_(fopen(name, "r")) {}
      ~FileHandle() { if (file_) fclose(file_); } // è‡ªåŠ¨å…³é—­
  };
  ```

> ğŸ’¡ **ç°ä»£ C++ é»„é‡‘æ³•åˆ™**ï¼š  
> **â€œæ ˆå¯¹è±¡ä¼˜å…ˆï¼Œå †å¯¹è±¡æ™ºèƒ½æŒ‡é’ˆï¼ŒRAII å°è£…èµ„æºâ€**

---

### ğŸ’» äº”ã€åŠ¨æ‰‹ä¸ºç‹ï¼šå¯è¿è¡Œç¤ºä¾‹

#### ç¤ºä¾‹ 1ï¼šæ ˆå¯¹è±¡ç”Ÿå‘½å‘¨æœŸ
```cpp
#include <iostream>

class Tracker {
    int id_;
public:
    Tracker(int id) : id_(id) {
        std::cout << "Construct " << id_ << "\n";
    }
    ~Tracker() {
        std::cout << "Destruct " << id_ << "\n";
    }
};

void f() {
    Tracker t1(1);
    {
        Tracker t2(2);
    } // t2 ææ„
    Tracker t3(3);
} // t3, t1 ææ„ï¼ˆé€†åºï¼‰

int main() {
    f();
    return 0;
}
```
> âœ… è¾“å‡ºï¼š
> ```
> Construct 1
> Construct 2
> Destruct 2
> Construct 3
> Destruct 3
> Destruct 1
> ```

#### ç¤ºä¾‹ 2ï¼šå †å¯¹è±¡ä¸æ³„æ¼
```cpp
#include <iostream>

void leak_demo() {
    Tracker* p = new Tracker(4); // æ—  delete â†’ æ³„æ¼
}

void safe_demo() {
    Tracker* p = new Tracker(5);
    delete p; // å®‰å…¨
}

int main() {
    leak_demo();
    safe_demo();
    return 0;
}
```

#### ç¤ºä¾‹ 3ï¼šRAII èµ„æºç®¡ç†
```cpp
#include <iostream>
#include <cstdio>

class FileOpener {
    FILE* file_;
public:
    FileOpener(const char* name) : file_(std::fopen(name, "w")) {
        if (!file_) throw std::runtime_error("Open failed");
        std::cout << "File opened\n";
    }
    
    ~FileOpener() {
        if (file_) {
            std::fclose(file_);
            std::cout << "File closed\n";
        }
    }
    
    FILE* get() { return file_; }
};

int main() {
    try {
        FileOpener f("test.txt");
        std::fprintf(f.get(), "Hello RAII!");
        // f è‡ªåŠ¨å…³é—­ï¼ˆå³ä½¿å¼‚å¸¸ï¼‰
    } catch (const std::exception& e) {
        std::cerr << "Error: " << e.what() << "\n";
    }
    return 0;
}
```

---

### ğŸ“ å…­ã€åˆ†å±‚ç»ƒä¹ é¢˜

#### ğŸ”¹ åŸºç¡€é¢˜
1. **ç”Ÿå‘½å‘¨æœŸè·Ÿè¸ª**  
   - ä¿®æ”¹ `Tracker` ç±»ï¼Œè·Ÿè¸ª 3 ä¸ªæ ˆå¯¹è±¡çš„æ„é€ /ææ„é¡ºåº

2. **å †å¯¹è±¡ç®¡ç†**  
   - åˆ›å»ºå † `Tracker`ï¼Œç¡®ä¿ `delete`

#### ğŸ”¸ è¿›é˜¶é¢˜
3. **RAII å®ç°**  
   - å®ç° `MutexLock` ç±»ï¼Œæ„é€ æ—¶åŠ é”ï¼Œææ„æ—¶è§£é”

4. **æ ˆæº¢å‡ºå®éªŒ**  
   - åˆ›å»ºå¤§æ•°ç»„ï¼Œè§‚å¯Ÿæ ˆæº¢å‡º

#### âš ï¸ é™·é˜±é¢˜ï¼ˆJava è¿ç§»è¯¯åŒºï¼‰
5. **â€œææ„å‡½æ•°ä¼šè‡ªåŠ¨è°ƒç”¨å§ï¼Ÿâ€**  
   - Q: å †å¯¹è±¡ `MyClass* p = new MyClass();` ä¼šè‡ªåŠ¨ææ„å—ï¼Ÿ  
   - A: âŒ **ä¸ä¼š**ï¼  
     â†’ **å¿…é¡» `delete p`**  
     â†’ å¦åˆ™å†…å­˜æ³„æ¼

6. **â€œJava finalize å’Œ C++ ææ„ä¸€æ ·å§ï¼Ÿâ€**  
   - Q: Java `finalize()` ç­‰ä»·äº C++ ææ„å‡½æ•°å—ï¼Ÿ  
   - A: âŒ **ä¸ç­‰ä»·**ï¼  
     â†’ C++ ææ„**ç¡®å®šæ€§è°ƒç”¨**  
     â†’ Java `finalize()` **ä¸å¯é **ï¼ˆå¯èƒ½ä¸è°ƒç”¨ï¼‰

---

### âš ï¸ ä¸ƒã€æ³¨æ„äº‹é¡¹ä¸å»ºè®®

| é—®é¢˜ | å»ºè®® |
|------|------|
| **å†…å­˜æ³„æ¼** | ç”¨æ™ºèƒ½æŒ‡é’ˆæˆ– RAII |
| **æ‚¬ç©ºæŒ‡é’ˆ** | `delete` åç½® `nullptr` |
| **æ ˆæº¢å‡º** | å¤§å¯¹è±¡æ”¾å †ï¼ˆ`std::vector`ï¼‰ |
| **å¼‚å¸¸å®‰å…¨** | RAII ç¡®ä¿å¼‚å¸¸æ—¶èµ„æºé‡Šæ”¾ |
| **ç°ä»£å®è·µ** | ä¼˜å…ˆæ ˆå¯¹è±¡ï¼Œé¿å…è£¸ `new`/`delete` |

> ğŸ’¡ **ç°ä»£ C++ é»„é‡‘æ³•åˆ™**ï¼š  
> **â€œèµ„æºè·å–å³åˆå§‹åŒ–ï¼ˆRAIIï¼‰ï¼›æ ˆå¯¹è±¡é›¶å¼€é”€ï¼›å †å¯¹è±¡æ™ºèƒ½æŒ‡é’ˆâ€**

---

### ğŸ” å…«ã€èºæ—‹å¤ä¹ 

- **è¡”æ¥ 1.4**ï¼šæ ˆ/å †å†…å­˜ç®¡ç†åŸºç¡€  
- **Java ç»éªŒ**ï¼šC++ ç¡®å®šæ€§ vs Java éç¡®å®šæ€§  
- **å½“æ—¥å¤ä¹ **ï¼šé»˜å†™å¯¹è±¡ç”Ÿå‘½å‘¨æœŸä¸‰å¤§è§„åˆ™

---

### ğŸ§  ä¹ã€ä¸»åŠ¨ learning ä»»åŠ¡

1. **è‡ªæˆ‘æé—®**ï¼š
   - â€œå¦‚ä½•ç”¨ RAII å®ç°çº¿ç¨‹å®‰å…¨é”ï¼Ÿâ€
   - â€œä¸ºä»€ä¹ˆ C++ ä¸å¼•å…¥ GCï¼Ÿâ€
2. **æ¦‚å¿µå›¾**ï¼šç”»å‡º C++ ä¸ Java ç”Ÿå‘½å‘¨æœŸå¯¹æ¯”
3. **æ‰®æ¼”æ•™å¸ˆ**ï¼šå‘åŒäº‹è§£é‡Šâ€œä¸ºä»€ä¹ˆ RAII æ¯” GC æ›´å¯é â€

---

### ğŸ” åã€å¤ç›˜æ¸…å•

âœ… æˆ‘èƒ½ç®¡ç†æ ˆ/å †å¯¹è±¡ç”Ÿå‘½å‘¨æœŸ  
âœ… æˆ‘ç†è§£ææ„å‡½æ•°çš„ç¡®å®šæ€§  
âœ… æˆ‘ä¼šç”¨ RAII å°è£…èµ„æº  
âœ… æˆ‘çŸ¥é“ä¸ Java GC çš„æ ¹æœ¬å·®å¼‚  
âœ… æˆ‘æ˜ç™½ç°ä»£ C++ çš„èµ„æºç®¡ç†æœ€ä½³å®è·µ

> ğŸ¯ **è¾¾æ ‡æ ‡å‡†**ï¼šå®ŒæˆåŸºç¡€é¢˜ + æ­£ç¡®åˆ†æé™·é˜±é¢˜ 5 å’Œ 6

---

## ğŸš€ ä¸‹ä¸€æ­¥å»ºè®®

ä½ å·²æŒæ¡ **C++ å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„æ ¸å¿ƒçŸ¥è¯†**ï¼

æ¥ä¸‹æ¥ä½ å¯ä»¥ï¼š
1. **ç»§ç»­å­¦ä¹  2.1.5 æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨ï¼šé«˜æ•ˆæ„é€ å¯¹è±¡**
2. **è¯·æ±‚ç”Ÿæˆã€ŒC++ ç”Ÿå‘½å‘¨æœŸé€ŸæŸ¥å¡ã€**
3. **è·³è½¬åˆ°ç»ƒä¹ é¢˜ç­”æ¡ˆä¸è§£æ**

è¯·å‘Šè¯‰æˆ‘ä½ çš„é€‰æ‹©ï¼Œæˆ‘ä»¬å°†ç»§ç»­å‰è¡Œï¼