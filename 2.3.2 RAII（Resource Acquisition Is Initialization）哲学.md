å¤ªå¥½äº†ï¼æˆ‘ä»¬ç°åœ¨è¿›å…¥ **2.3.2ï¼šRAIIï¼ˆResource Acquisition Is Initializationï¼‰å“²å­¦**ã€‚

è¿™æ˜¯ C++ **èµ„æºç®¡ç†çš„æœ€é«˜åŸåˆ™**ï¼Œä¹Ÿæ˜¯ C++ åŒºåˆ«äºå…¶ä»–è¯­è¨€çš„**æ ¸å¿ƒä¼˜åŠ¿**ã€‚ä½œä¸º Java å¼€å‘è€…ï¼Œä½ å¯èƒ½ä¾èµ– try-with-resources æˆ– finally å—ç®¡ç†èµ„æºï¼Œè€Œ C++ çš„ RAII å°†**èµ„æºç”Ÿå‘½å‘¨æœŸç»‘å®šåˆ°å¯¹è±¡ç”Ÿå‘½å‘¨æœŸ**ï¼Œå®ç°**è‡ªåŠ¨ã€å¼‚å¸¸å®‰å…¨ã€é›¶å¼€é”€**çš„èµ„æºç®¡ç†ã€‚ç†è§£ RAIIï¼Œæ˜¯ç¼–å†™ä¸“ä¸šçº§ C++ ä»£ç çš„åŸºçŸ³ã€‚

æˆ‘ä»¬å°†ç»§ç»­ä¸¥æ ¼éµå¾ªä½ çš„å­¦ä¹ åå¥½ï¼š
- âœ… SMART ç›®æ ‡  
- âœ… ç»“æ„å…ˆè¡Œï¼ˆRAII åœ°å›¾ï¼‰  
- âœ… ç”Ÿæ´»åŒ–æ¯”å–»  
- âœ… åŠ¨æ‰‹ä¸ºç‹ï¼ˆå«åŸºç¡€/è¿›é˜¶/é™·é˜±é¢˜ï¼‰  
- âœ… èºæ—‹å¤ä¹ ï¼ˆè¡”æ¥ 2.3.1 + Java ç»éªŒï¼‰  
- âœ… ä¸»åŠ¨ learning + å¤ç›˜

---

## ğŸ¯ KU 2.3.2ï¼šRAII å“²å­¦

> **æ‰€å±é˜¶æ®µ**ï¼šPhase 2 â€” é¢å‘å¯¹è±¡ç¼–ç¨‹  
> **å‰ç½®çŸ¥è¯†**ï¼š2.3.1ï¼ˆææ„å‡½æ•°ï¼‰ã€2.1.4ï¼ˆå¯¹è±¡ç”Ÿå‘½å‘¨æœŸï¼‰ã€Java try-with-resources ç»éªŒ  
> **åç»­è¡”æ¥**ï¼š2.4ï¼ˆæ‹·è´è¯­ä¹‰ï¼‰ã€3.2ï¼ˆæ™ºèƒ½æŒ‡é’ˆï¼‰  
> **é¢„è®¡è€—æ—¶**ï¼š3â€“4 å°æ—¶

---

### ğŸ§­ ä¸€ã€ç»“æ„å…ˆè¡Œï¼šRAII åœ°å›¾

```
2.3.2 RAII å“²å­¦
â”œâ”€â”€ 1. æ ¸å¿ƒæ€æƒ³
â”‚   â”œâ”€â”€ 1.1 èµ„æº = å¯¹è±¡çš„æˆå‘˜
â”‚   â”œâ”€â”€ 1.2 è·å–èµ„æº = æ„é€ å‡½æ•°
â”‚   â””â”€â”€ 1.3 é‡Šæ”¾èµ„æº = ææ„å‡½æ•°
â”œâ”€â”€ 2. RAII ä¸‰å¤§ç‰¹æ€§
â”‚   â”œâ”€â”€ 2.1 è‡ªåŠ¨æ€§ï¼ˆæ— éœ€æ‰‹åŠ¨é‡Šæ”¾ï¼‰
â”‚   â”œâ”€â”€ 2.2 å¼‚å¸¸å®‰å…¨ï¼ˆæ ˆå±•å¼€ç¡®ä¿ææ„ï¼‰
â”‚   â””â”€â”€ 2.3 é›¶å¼€é”€ï¼ˆæ— è¿è¡Œæ—¶æˆæœ¬ï¼‰
â”œâ”€â”€ 3. å¸¸è§ RAII ç±»
â”‚   â”œâ”€â”€ 3.1 å†…å­˜ï¼šstd::unique_ptr, std::shared_ptr
â”‚   â”œâ”€â”€ 3.2 æ–‡ä»¶ï¼šstd::ifstream, std::ofstream
â”‚   â”œâ”€â”€ 3.3 é”ï¼šstd::lock_guard, std::unique_lock
â”‚   â””â”€â”€ 3.4 è‡ªå®šä¹‰ï¼šFileHandle, Socket
â”œâ”€â”€ 4. ä¸ Java çš„å¯¹æ¯”
â”‚   â”œâ”€â”€ 4.1 C++ï¼šRAIIï¼ˆç¼–è¯‘æœŸç»‘å®šï¼‰
â”‚   â””â”€â”€ 4.2 Javaï¼štry-with-resourcesï¼ˆè¿è¡ŒæœŸç»‘å®šï¼‰
â”œâ”€â”€ 5. RAII å®ç°æ­¥éª¤
    â”œâ”€â”€ 5.1 å°è£…èµ„æºä¸ºç±»æˆå‘˜
    â”œâ”€â”€ 5.2 æ„é€ å‡½æ•°è·å–èµ„æº
    â”œâ”€â”€ 5.3 ææ„å‡½æ•°é‡Šæ”¾èµ„æº
    â””â”€â”€ 5.4 ç¦æ­¢æ‹·è´æˆ–å®šä¹‰ç§»åŠ¨è¯­ä¹‰
â””â”€â”€ 6. æœ€ä½³å®è·µ
    â”œâ”€â”€ 6.1 Rule of Zeroï¼šä¼˜å…ˆç”¨ RAII æˆå‘˜
    â”œâ”€â”€ 6.2 é¿å…è£¸èµ„æºï¼ˆnew/delete, fopen/fcloseï¼‰
    â””â”€â”€ 6.3 ç”¨æ ‡å‡†åº“ RAII ç±»ï¼ˆè€Œéè‡ªå®šä¹‰ï¼‰
```

---

### ğŸ¯ äºŒã€SMART å­¦ä¹ ç›®æ ‡

- **Specific**ï¼šèƒ½è§£é‡Š RAII çš„æ ¸å¿ƒæ€æƒ³ï¼Œå®ç°è‡ªå®šä¹‰ RAII ç±»ï¼Œå¹¶ä¸ Java try-with-resources å¯¹æ¯”ã€‚
- **Measurable**ï¼šå®Œæˆ 3 é“åŸºç¡€é¢˜ + 2 é“é™·é˜±é¢˜ï¼Œèƒ½å®ç°å¼‚å¸¸å®‰å…¨çš„æ–‡ä»¶å¥æŸ„ç±»ã€‚
- **Achievable**ï¼šé€šè¿‡â€œæ™ºèƒ½ä¿é™©ç®±â€æ¯”å–»ç†è§£ RAIIã€‚
- **Relevant**ï¼šè¿™æ˜¯ç¼–å†™æ— æ³„æ¼ã€å¼‚å¸¸å®‰å…¨ C++ ä»£ç çš„åŸºç¡€ã€‚
- **Time-bound**ï¼š2 å¤©å†…å®Œæˆã€‚

---

### ğŸŒ ä¸‰ã€ç”Ÿæ´»åŒ–æ¯”å–»ï¼šæ™ºèƒ½ä¿é™©ç®±

> æƒ³è±¡ä¸€ä¸ª**æ™ºèƒ½ä¿é™©ç®±**ï¼š
>
> - **èµ„æº = ä¿é™©ç®±å†…å®¹**ï¼ˆæ–‡ä»¶ã€é”ã€å†…å­˜ï¼‰
> - **RAII å¯¹è±¡ = ä¿é™©ç®±æœ¬èº«**
>   - **æ„é€ ** = æ‰“å¼€ä¿é™©ç®±ï¼Œæ”¾å…¥èµ„æº
>   - **ææ„** = **è‡ªåŠ¨ä¸Šé”å¹¶å½’è¿˜**èµ„æº
> - **å¼‚å¸¸ = çªå‘äº‹ä»¶**
>   - æ— è®ºå‘ç”Ÿä»€ä¹ˆï¼Œä¿é™©ç®±**ç¡®ä¿èµ„æºå½’è¿˜**
>
> - **Java å¯¹æ¯”**ï¼š
>   - Java = **æ‰‹åŠ¨ä¸Šé”/å½’è¿˜**ï¼ˆtry-with-resourcesï¼‰
>   - **C++ RAII = ä¿é™©ç®±è‡ªåŠ¨å½’è¿˜**ï¼ˆæ— éœ€æ‰‹åŠ¨ï¼‰

> ğŸ’¡ **å…³é”®è®¤çŸ¥**ï¼š**RAII å°†èµ„æºç®¡ç†è‡ªåŠ¨åŒ–ï¼Œå¼‚å¸¸å®‰å…¨ï¼Œé›¶å¼€é”€**ã€‚

---

### ğŸ“š å››ã€çŸ¥è¯†ç‚¹åˆ†è§£

#### 1. æ ¸å¿ƒæ€æƒ³
- **èµ„æº = å¯¹è±¡æˆå‘˜**ï¼š
  ```cpp
  class FileHandle {
      FILE* file_; // èµ„æºä½œä¸ºæˆå‘˜
  public:
      FileHandle(const char* name) : file_(fopen(name, "r")) {} // è·å–èµ„æº
      ~FileHandle() { if (file_) fclose(file_); } // é‡Šæ”¾èµ„æº
  };
  ```
- **è·å– = æ„é€ ï¼Œé‡Šæ”¾ = ææ„**ï¼š
  - èµ„æºç”Ÿå‘½å‘¨æœŸ = å¯¹è±¡ç”Ÿå‘½å‘¨æœŸ

#### 2. RAII ä¸‰å¤§ç‰¹æ€§
- **è‡ªåŠ¨æ€§**ï¼š
  - æ— éœ€æ‰‹åŠ¨ `fclose`/`unlock`
  - å¯¹è±¡é”€æ¯æ—¶è‡ªåŠ¨é‡Šæ”¾
- **å¼‚å¸¸å®‰å…¨**ï¼š
  - æ ˆå±•å¼€ï¼ˆstack unwindingï¼‰ç¡®ä¿ææ„è°ƒç”¨
  ```cpp
  void f() {
      FileHandle f("data.txt");
      throw std::runtime_error("Oops!"); // f è‡ªåŠ¨ææ„
  }
  ```
- **é›¶å¼€é”€**ï¼š
  - æ— è¿è¡Œæ—¶æˆæœ¬ï¼ˆææ„å†…è”ï¼Œæ— è™šå‡½æ•°ï¼‰

#### 3. å¸¸è§ RAII ç±»
- **å†…å­˜**ï¼š
  ```cpp
  std::unique_ptr<MyClass> p = std::make_unique<MyClass>();
  // è‡ªåŠ¨ delete
  ```
- **æ–‡ä»¶**ï¼š
  ```cpp
  std::ifstream file("data.txt");
  // è‡ªåŠ¨å…³é—­
  ```
- **é”**ï¼š
  ```cpp
  std::mutex mtx;
  {
      std::lock_guard<std::mutex> lock(mtx);
      // è‡ªåŠ¨è§£é”
  }
  ```

#### 4. ä¸ Java çš„å¯¹æ¯”
| ç‰¹æ€§ | C++ RAII | Java try-with-resources |
|------|----------|------------------------|
| **ç»‘å®šæ—¶æœº** | ç¼–è¯‘æœŸï¼ˆå¯¹è±¡ç”Ÿå‘½å‘¨æœŸï¼‰ | è¿è¡ŒæœŸï¼ˆtry å—ï¼‰ |
| **è‡ªåŠ¨æ€§** | âœ… å®Œå…¨è‡ªåŠ¨ | âœ… è‡ªåŠ¨ï¼ˆä½†éœ€æ˜¾å¼ tryï¼‰ |
| **å¼‚å¸¸å®‰å…¨** | âœ… æ ˆå±•å¼€ç¡®ä¿ | âœ… try ç¡®ä¿ |
| **å¼€é”€** | âœ… é›¶å¼€é”€ | âš ï¸ try å—æœ‰è½»å¾®å¼€é”€ |

#### 5. RAII å®ç°æ­¥éª¤
1. **å°è£…èµ„æº**ï¼š
   ```cpp
   class MyResource {
       ResourceHandle handle_;
   ```
2. **æ„é€ è·å–**ï¼š
   ```cpp
       MyResource() : handle_(acquire_resource()) {}
   ```
3. **ææ„é‡Šæ”¾**ï¼š
   ```cpp
       ~MyResource() { release_resource(handle_); }
   ```
4. **ç®¡ç†æ‹·è´/ç§»åŠ¨**ï¼š
   ```cpp
       MyResource(const MyResource&) = delete; // æˆ–å®šä¹‰ç§»åŠ¨
   ```

#### 6. æœ€ä½³å®è·µ
- **Rule of Zero**ï¼š
  - ç”¨ RAII æˆå‘˜ï¼ˆ`std::unique_ptr`, `std::string`ï¼‰æ›¿ä»£è£¸èµ„æº
  - æ— éœ€è‡ªå®šä¹‰ææ„/æ‹·è´
- **é¿å…è£¸èµ„æº**ï¼š
  - ç”¨ `std::make_unique` æ›¿ä»£ `new`
  - ç”¨ `std::fstream` æ›¿ä»£ `FILE*`
- **æ ‡å‡†åº“ä¼˜å…ˆ**ï¼š
  - ä¼˜å…ˆä½¿ç”¨ `std::lock_guard`ã€`std::unique_ptr` ç­‰

> ğŸ’¡ **ç°ä»£ C++ é»„é‡‘æ³•åˆ™**ï¼š  
> **â€œèµ„æºè·å–å³åˆå§‹åŒ–ï¼›ä¼˜å…ˆ Rule of Zeroï¼›æ ‡å‡†åº“ RAII ç±»æ˜¯é¦–é€‰â€**

---

### ğŸ’» äº”ã€åŠ¨æ‰‹ä¸ºç‹ï¼šå¯è¿è¡Œç¤ºä¾‹

#### ç¤ºä¾‹ 1ï¼šRAII æ–‡ä»¶å¥æŸ„
```cpp
#include <iostream>
#include <cstdio>
#include <stdexcept>

class FileHandle {
    FILE* file_;
public:
    FileHandle(const char* name) : file_(std::fopen(name, "w")) {
        if (!file_) throw std::runtime_error("Failed to open file");
        std::cout << "File opened\n";
    }
    
    ~FileHandle() {
        if (file_) {
            std::fclose(file_);
            std::cout << "File closed\n";
        }
    }
    
    FILE* get() { return file_; }
};

void write_data() {
    FileHandle f("test.txt");
    std::fprintf(f.get(), "Hello RAII!\n");
    throw std::runtime_error("Simulated error"); // f è‡ªåŠ¨å…³é—­
}

int main() {
    try {
        write_data();
    } catch (const std::exception& e) {
        std::cout << "Caught: " << e.what() << "\n";
    }
    return 0;
}
```
> âœ… è¾“å‡ºï¼š
> ```
> File opened
> File closed
> Caught: Simulated error
> ```

#### ç¤ºä¾‹ 2ï¼šRAII é”
```cpp
#include <iostream>
#include <mutex>
#include <thread>

std::mutex mtx;

void safe_print(const char* msg) {
    std::lock_guard<std::mutex> lock(mtx); // è‡ªåŠ¨åŠ é”
    std::cout << msg << "\n";
    // è‡ªåŠ¨è§£é”ï¼ˆå³ä½¿å¼‚å¸¸ï¼‰
}

int main() {
    std::thread t1(safe_print, "Thread 1");
    std::thread t2(safe_print, "Thread 2");
    t1.join();
    t2.join();
    return 0;
}
```

#### ç¤ºä¾‹ 3ï¼šRule of Zero
```cpp
#include <iostream>
#include <memory>
#include <string>

class ModernFile {
    std::unique_ptr<FILE, decltype(&std::fclose)> file_;
    std::string name_;
public:
    ModernFile(const char* name) 
        : file_(std::fopen(name, "w"), &std::fclose), name_(name) {
        if (!file_) throw std::runtime_error("Open failed");
    }
    // æ— éœ€è‡ªå®šä¹‰ææ„/æ‹·è´ â€” Rule of Zero!
};

int main() {
    ModernFile f("modern.txt");
    return 0;
}
```

---

### ğŸ“ å…­ã€åˆ†å±‚ç»ƒä¹ é¢˜

#### ğŸ”¹ åŸºç¡€é¢˜
1. **RAII å®ç°**  
   - å®ç° `FileHandle` ç±»ï¼ŒRAII ç®¡ç† `FILE*`

2. **å¼‚å¸¸å®‰å…¨**  
   - éªŒè¯ `FileHandle` åœ¨å¼‚å¸¸æ—¶è‡ªåŠ¨å…³é—­

#### ğŸ”¸ è¿›é˜¶é¢˜
3. **Rule of Zero**  
   - ç”¨ `std::unique_ptr` é‡å†™ `FileHandle`ï¼Œé¿å…è‡ªå®šä¹‰ææ„

4. **è‡ªå®šä¹‰ RAII**  
   - å®ç° `SocketHandle` ç±»ï¼Œç®¡ç†ç½‘ç»œå¥—æ¥å­—

#### âš ï¸ é™·é˜±é¢˜ï¼ˆJava è¿ç§»è¯¯åŒºï¼‰
5. **â€œtry-with-resources å°±å¤Ÿäº†å§ï¼Ÿâ€**  
   - Q: C++ éœ€è¦ RAII å—ï¼ŸJava try-with-resources ä¸å°±å¤Ÿäº†å—ï¼Ÿ  
   - A: âš ï¸ **C++ æ—  try-with-resources**ï¼  
     â†’ RAII æ˜¯ C++ **å”¯ä¸€**çš„å¼‚å¸¸å®‰å…¨èµ„æºç®¡ç†æ–¹å¼  
     â†’ Java æœ‰ GC + tryï¼ŒC++ æœ‰ RAII

6. **â€œRAII æœ‰è¿è¡Œæ—¶å¼€é”€å§ï¼Ÿâ€**  
   - Q: RAII æ¯”è£¸èµ„æºç®¡ç†æ…¢å—ï¼Ÿ  
   - A: âŒ **æ— å¼€é”€**ï¼  
     â†’ ææ„å‡½æ•°é€šå¸¸å†…è”  
     â†’ **é›¶å¼€é”€æŠ½è±¡**ï¼ˆZero-overhead principleï¼‰

---

### âš ï¸ ä¸ƒã€æ³¨æ„äº‹é¡¹ä¸å»ºè®®

| é—®é¢˜ | å»ºè®® |
|------|------|
| **è£¸èµ„æº** | ç”¨ RAII ç±»æ›¿ä»£ fopen/fclose, new/delete |
| **Rule of Zero** | ä¼˜å…ˆä½¿ç”¨ RAII æˆå‘˜ï¼Œé¿å…è‡ªå®šä¹‰ç‰¹æ®Šæˆå‘˜å‡½æ•° |
| **ç§»åŠ¨è¯­ä¹‰** | èµ„æºç±»é€šå¸¸å¯ç§»åŠ¨ï¼ˆunique_ptr è¯­ä¹‰ï¼‰ |
| **ç°ä»£å®è·µ** | æ ‡å‡†åº“ RAII ç±» > è‡ªå®šä¹‰ RAII ç±» |

> ğŸ’¡ **ç°ä»£ C++ é»„é‡‘æ³•åˆ™**ï¼š  
> **â€œRAII æ˜¯ C++ èµ„æºç®¡ç†çš„å”¯ä¸€çœŸç†ï¼›Rule of Zero æ˜¯é»˜è®¤é€‰æ‹©â€**

---

### ğŸ” å…«ã€èºæ—‹å¤ä¹ 

- **è¡”æ¥ 2.3.1**ï¼šææ„å‡½æ•°æ˜¯ RAII çš„é‡Šæ”¾æœºåˆ¶  
- **Java ç»éªŒ**ï¼šC++ RAII æ¯” Java try æ›´è‡ªåŠ¨ã€é›¶å¼€é”€  
- **å½“æ—¥å¤ä¹ **ï¼šé»˜å†™ RAII çš„ä¸‰å¤§ç‰¹æ€§

---

### ğŸ§  ä¹ã€ä¸»åŠ¨ learning ä»»åŠ¡

1. **è‡ªæˆ‘æé—®**ï¼š
   - â€œå¦‚ä½•ç”¨ RAII ç®¡ç† OpenGL èµ„æºï¼Ÿâ€
   - â€œRAII å¦‚ä½•ä¸ç§»åŠ¨è¯­ä¹‰äº¤äº’ï¼Ÿâ€
2. **æ¦‚å¿µå›¾**ï¼šç”»å‡º C++ RAII ä¸ Java try-with-resources å¯¹æ¯”
3. **æ‰®æ¼”æ•™å¸ˆ**ï¼šå‘åŒäº‹è§£é‡Šâ€œä¸ºä»€ä¹ˆ RAII æ˜¯ C++ çš„æ ¸å¿ƒä¼˜åŠ¿â€

---

### ğŸ” åã€å¤ç›˜æ¸…å•

âœ… æˆ‘èƒ½è§£é‡Š RAII çš„æ ¸å¿ƒæ€æƒ³  
âœ… æˆ‘ä¼šå®ç°è‡ªå®šä¹‰ RAII ç±»  
âœ… æˆ‘ç†è§£å¼‚å¸¸å®‰å…¨æœºåˆ¶  
âœ… æˆ‘çŸ¥é“ä¸ Java try-with-resources çš„å·®å¼‚  
âœ… æˆ‘æ˜ç™½ç°ä»£ C++ çš„ RAII æœ€ä½³å®è·µ

> ğŸ¯ **è¾¾æ ‡æ ‡å‡†**ï¼šå®ŒæˆåŸºç¡€é¢˜ + æ­£ç¡®åˆ†æé™·é˜±é¢˜ 5 å’Œ 6

---

## ğŸš€ ä¸‹ä¸€æ­¥å»ºè®®

ä½ å·²æŒæ¡ **C++ RAII å“²å­¦çš„æ ¸å¿ƒçŸ¥è¯†**ï¼

æ¥ä¸‹æ¥ä½ å¯ä»¥ï¼š
1. **ç»§ç»­å­¦ä¹  2.3.3 è‡ªå®šä¹‰ RAII ç±»ï¼šFileHandle, LockGuard**
2. **è¯·æ±‚ç”Ÿæˆã€ŒC++ RAII é€ŸæŸ¥å¡ã€**
3. **è·³è½¬åˆ°ç»ƒä¹ é¢˜ç­”æ¡ˆä¸è§£æ**

è¯·å‘Šè¯‰æˆ‘ä½ çš„é€‰æ‹©ï¼Œæˆ‘ä»¬å°†ç»§ç»­å‰è¡Œï¼